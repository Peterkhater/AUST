<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - FarmConnect AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js for interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        sky: {
                            day: {
                                light: '#38bdf8',
                                medium: '#0ea5e9',
                                dark: '#0284c7'
                            },
                            night: {
                                light: '#1e40af',
                                medium: '#1e3a8a',
                                dark: '#172554'
                            }
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.7s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/css">
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: black;
               background: linear-gradient(to bottom, #1e40af, #1e3a8a, #172554);
        }
        
        /* Animated sky background */
        .sky-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: all 1.5s ease;
        }
        
        .day-sky {
            /* background: linear-gradient(to bottom, #38bdf8, #0ea5e9, #0284c7); */
        }
        
        .night-sky {
            /* background: linear-gradient(to bottom, #1e40af, #1e3a8a, #172554); */
        }
        
        /* Cloud animation */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
        }
        
        .cloud-1 {
            width: 120px;
            height: 40px;
            top: 20%;
            left: 10%;
            animation: float 25s infinite ease-in-out;
        }
        
        .cloud-2 {
            width: 80px;
            height: 30px;
            top: 30%;
            right: 15%;
            animation: float 20s infinite ease-in-out;
            animation-delay: 2s;
        }
        
        .cloud-3 {
            width: 100px;
            height: 35px;
            top: 25%;
            left: 60%;
            animation: float 30s infinite ease-in-out;
            animation-delay: 5s;
        }
        
        /* Stars for night sky */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 4s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(30px) translateY(10px); }
            50% { transform: translateX(0) translateY(20px); }
            75% { transform: translateX(-30px) translateY(10px); }
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Weather card styling */
        .weather-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Map container */
        #map {
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #16a34a;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #15803d;
        }
        
        /* Swiper customization */
        .swiper-pagination-bullet-active {
            background-color: white !important;
        }
        
        .swiper-slide {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white min-h-screen overflow-x-hidden" x-data="weatherApp()" x-init="init()">
    <!-- Animated Sky Background -->
    <div class="sky-background" :class="isDaytime ? 'day-sky' : 'night-sky'">
        <template x-if="isDaytime">
            <div>
                <div class="cloud cloud-1"></div>
                <div class="cloud cloud-2"></div>
                <div class="cloud cloud-3"></div>
            </div>
        </template>
        <template x-if="!isDaytime">
            <div>
                <div class="star" style="top: 15%; left: 20%; width: 2px; height: 2px; animation-delay: 0s;"></div>
                <div class="star" style="top: 25%; left: 50%; width: 3px; height: 3px; animation-delay: 1s;"></div>
                <div class="star" style="top: 10%; left: 70%; width: 2px; height: 2px; animation-delay: 2s;"></div>
                <div class="star" style="top: 30%; left: 30%; width: 2px; height: 2px; animation-delay: 0.5s;"></div>
                <div class="star" style="top: 20%; left: 80%; width: 3px; height: 3px; animation-delay: 1.5s;"></div>
                <div class="star" style="top: 35%; left: 60%; width: 2px; height: 2px; animation-delay: 2.5s;"></div>
            </div>
        </template>
    </div>
    
    <!-- Navigation -->
    <nav class="sticky top-0 w-full bg-white/10 backdrop-blur-sm z-50 py-4">
        <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <span class="text-white">
                    <i class="fas fa-leaf text-2xl"></i>
                </span>
                <span class="font-bold text-xl text-white">FarmConnect<span class="text-primary-400">AI</span></span>
            </a>
            
            <div class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-200 hover:text-white transition">Home</a>
                <a href="#" class="text-gray-200 hover:text-white transition">Marketplace</a>
                <a href="#" class="text-white font-medium hover:text-primary-300 transition">Weather</a>
                <a href="#" class="text-gray-200 hover:text-white transition">For Farmers</a>
                <a href="#" class="text-gray-200 hover:text-white transition">Dashboard</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <button class="text-gray-200 hover:text-white transition" @click="isDaytime = !isDaytime">
                    <i class="fas fa-moon" x-show="isDaytime"></i>
                    <i class="fas fa-sun" x-show="!isDaytime"></i>
                </button>
                <div class="hidden md:flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 md:px-6 py-8">
        <!-- Location & Time Toggle -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold" x-text="selectedLocation.name"></h1>
                <p class="text-gray-200" id="current-date">Loading date...</p>
            </div>
            
            <div class="mt-4 md:mt-0 flex items-center space-x-4">
                <div class="flex items-center bg-white/10 rounded-full px-4 py-2">
                    <span class="text-sm mr-2">C°</span>
                    <label class="toggle-switch">
                        <input type="checkbox" x-model="useFahrenheit">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="text-sm ml-2">F°</span>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button class="bg-white/10 rounded-full p-2 hover:bg-white/20 transition" @click="refreshWeather" >
                        <i class="fas fa-sync-alt" :class="{'loading': refreshing}"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div x-show="errorMessage" class="bg-red-500/80 text-white p-4 rounded-lg mb-6" x-transition>
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span x-text="errorMessage"></span>
            </div>
        </div>
        
        <!-- Current Weather Card -->
        <div class="weather-card rounded-2xl p-8 mb-8 shadow-lg" x-show="currentWeather">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <div class="flex items-center justify-center md:justify-start">
                        <span class="text-7xl md:text-8xl font-light" x-text="useFahrenheit ? currentWeather.main.tempF : currentWeather.main.temp"></span>
                        <span class="text-4xl mt-4">°<span x-text="useFahrenheit ? 'F' : 'C'"></span></span>
                    </div>
                    <p class="text-xl capitalize mt-2" x-text="currentWeather.weather[0].description"></p>
                    <p class="text-gray-200">Feels like <span x-text="useFahrenheit ? currentWeather.main.feels_likeF : currentWeather.main.feels_like"></span>°</p>
                </div>
                
                <div class="text-8xl">
                    <i :class="getWeatherIcon(currentWeather.weather[0].icon)" :class="getWeatherIconColor(currentWeather.weather[0].icon)"></i>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 pt-8 border-t border-white/20">
                <div class="text-center">
                    <p class="text-gray-200">Wind</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.wind.speed} m/s`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Humidity</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.main.humidity}%`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Pressure</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.main.pressure} hPa`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Visibility</p>
                    <p class="text-xl font-semibold" x-text="`${(currentWeather.visibility / 1000).toFixed(1)} km`"></p>
                </div>
            </div>
        </div>
        
        <!-- Weekly Forecast -->
        <div class="mb-8" x-show="forecast">
            <h2 class="text-2xl font-bold mb-4">7-Day Forecast</h2>
            
            <!-- Swiper Forecast -->
            <div class="swiper forecast-swiper">
                <div class="swiper-wrapper">
                    <template x-for="(day, index) in forecast.daily" :key="index">
                        <div class="swiper-slide weather-card rounded-2xl p-4 text-center">
                            <p class="font-semibold mb-2" x-text="new Date(day.dt * 1000).toLocaleDateString('en-US', {weekday: 'short'})"></p>
                            <div class="text-3xl mb-2">
                                <i :class="getWeatherIcon(day.weather[0].icon)" :class="getWeatherIconColor(day.weather[0].icon)"></i>
                            </div>
                            <div class="flex justify-center space-x-3">
                                <span x-text="useFahrenheit ? day.temp.maxF : day.temp.max"></span>
                                <span class="text-gray-300" x-text="useFahrenheit ? day.temp.minF : day.temp.min"></span>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="swiper-pagination mt-4"></div>
            </div>
        </div>
        
        <!-- Map & Locations -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Map Container -->
            <div class="order-2 lg:order-1">
                <h2 class="text-2xl font-bold mb-4">Bekaa Region</h2>
                <div id="map" class="h-96 rounded-2xl"></div>
            </div>
            
            <!-- Location List -->
            <div class="order-1 lg:order-2">
                <h2 class="text-2xl font-bold mb-4">Locations</h2>
                <div class="space-y-4" style="overflow-y: scroll; max-height: 380px;">
                    <template x-for="(location, index) in locations" :key="index">
                        <div class="weather-card rounded-2xl p-4 cursor-pointer transition hover:bg-white/10" 
                             @click="selectLocation(location)"
                             :class="{ 'bg-white/10': selectedLocation.name === location.name }">
                            <div class="flex justify-between items-center">
                                <span x-text="location.name"></span>
                                <div class="flex items-center" x-show="location.currentWeather">
                                    <span class="text-xl mr-2" x-text="useFahrenheit ? location.currentWeather.main.tempF : location.currentWeather.main.temp"></span>
                                    <i :class="getWeatherIcon(location.currentWeather.weather[0].icon)" :class="getWeatherIconColor(location.currentWeather.weather[0].icon)"></i>
                                    
                                </div>
                                <div x-show="!location.currentWeather" class="loading"></div>
                            </div>
                        </div>
                    </template>
                </div>
                
                
            </div>
        </div>
        
        <!-- Hourly Forecast (Collapsible) -->
        <div class="weather-card rounded-2xl p-6 mt-8" x-show="forecast">
            <div class="flex justify-between items-center cursor-pointer" id="hourly-forecast-toggle">
                <h2 class="text-2xl font-bold">24-Hour Forecast</h2>
                <i class="fas fa-chevron-down transition-transform" id="hourly-chevron"></i>
            </div>
            
            <div class="mt-4 overflow-hidden transition-all duration-300" id="hourly-forecast-content" style="max-height: 0px;">
                <div class="flex overflow-x-auto pb-4 space-x-4 pt-2">
                    <template x-for="(hour, index) in forecast.hourly.slice(0, 24)" :key="index">
                        <div class="flex-shrink-0 text-center">
                            <p class="text-sm" x-text="new Date(hour.dt * 1000).toLocaleTimeString('en-US', {hour: 'numeric'})"></p>
                            <i :class="getWeatherIcon(hour.weather[0].icon)" :class="getWeatherIconColor(hour.weather[0].icon)" class="text-2xl my-2"></i>
                            <p class="font-semibold" x-text="useFahrenheit ? hour.tempF : hour.temp"></p>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </main>





<div class="weather-card rounded-2xl p-6 mb-8 mx-10">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-seedling text-primary-400 mr-2"></i>AI Farming Advisory
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Watering Advice -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-tint text-2xl mr-3 text-blue-400"></i>
                        <h3 class="text-lg font-semibold">Watering Advice</h3>
                    </div>
                    <p>{{ ai_advisory.watering }}</p>
                </div>
                
                <!-- Fertilization Advice -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-flask text-2xl mr-3 text-green-400"></i>
                        <h3 class="text-lg font-semibold">Fertilization Advice</h3>
                    </div>
                    <p>{{ ai_advisory.fertilization }}</p>
                </div>
                
                <!-- Pest Risk -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-bug text-2xl mr-3 text-red-400"></i>
                        <h3 class="text-lg font-semibold">Pest Risk</h3>
                    </div>
                    <p>{{ ai_advisory.pest_risk }}</p>
                </div>
                
                <!-- Harvest Tips -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-scythe text-2xl mr-3 text-amber-400"></i>
                        <h3 class="text-lg font-semibold">Harvest Tips</h3>
                    </div>
                    <p>{{ ai_advisory.harvest }}</p>
                </div>
            </div>
        </div>

                            

       <!-- Alerts Section -->
<!-- Show this section only if there are alerts -->
{% if ai_advisory.weather_alerts %}
    <div class="weather-card rounded-2xl p-6 mb-8 mx-8">
        <h2 class="text-2xl font-bold mb-4 flex items-center ">
            <i class="fas fa-bell text-amber-400 mr-2"></i>Ai Weather Alerts
        </h2>
        
        <div class="grid grid-cols-1 gap-4">
            <!-- Loop through each alert in the list -->
            {% for alert in ai_advisory.weather_alerts %}
                
                <div class="p-4 rounded-lg flex items-start border-l-4 border-red-500 text-red-700 bg-[rgba(225,80,80,0.3)]">
                    <i class="fas fa-exclamation-triangle text-xl mt-1 mr-3"></i>
                    <div>
                        <h3 class="font-semibold text-white">{{ alert.title }}</h3>
                        <p class="text-sm mt-1 text-white">{{ alert.description }}</p>
                        <p class="text-xs text-gray mt-2">{{ alert.time }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% else %}
    <!-- Display a message if no alerts are found -->
    <div class="weather-card rounded-2xl p-6 mb-8 text-center text-gray-500">
        <p>No specific weather alerts at this time.</p>
    </div>
{% endif %}


    <!-- Footer -->
    <footer class="bg-white/5 mt-16 py-10">
        <div class="container mx-auto px-4 md:px-6">
            <div class="text-center">
                <div class="flex items-center justify-center mb-6">
                    <span class="text-primary-400 mr-2">
                        <i class="fas fa-leaf text-2xl"></i>
                    </span>
                    <span class="font-bold text-xl text-white">FarmConnect<span class="text-primary-400">AI</span></span>
                </div>
                <p class="text-gray-300 mb-6">Providing accurate weather forecasts for farmers in the Bekaa Valley</p>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
                <p class="text-gray-400 text-sm mt-6">© 2023 FarmConnect AI. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

<script>
function weatherApp() {
    return {
        apiKey:"{{weather_api}}",
        defaultLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        selectedLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        locations: [
            { name: 'Ain Zebde', lat: 33.6333, lon: 35.8667 },
        { name: 'Al Ain', lat: 33.7333, lon: 35.8833 },
        { name: 'Amik', lat: 33.9833, lon: 36.0667 },
        { name: 'Anjar', lat: 33.7300, lon: 35.9300 },
        { name: 'Aitanite', lat: 33.5667, lon: 35.8000 },
        { name: 'Baalbek', lat: 34.0058, lon: 36.2181 },
        { name: 'Barelias', lat: 33.8167, lon: 35.9833 },
        { name: 'Beddawi', lat: 34.4500, lon: 36.0000 },
        { name: 'Bekaa Valley', lat: 33.8333, lon: 35.9000 },
        { name: 'Beriut', lat: 33.8933, lon: 35.5017 },
        { name: 'Bire', lat: 33.8167, lon: 35.8667 },
        { name: 'Brital', lat: 34.1333, lon: 36.2000 },
        { name: 'Chlifa', lat: 33.5667, lon: 35.8333 },
        { name: 'Chmistar', lat: 33.7167, lon: 35.7167 },
        { name: 'Chtaura', lat: 33.8167, lon: 35.8500 },
        { name: 'Deir el Ahmar', lat: 34.1167, lon: 36.1333 },
        { name: 'Deir Zanoun', lat: 33.5500, lon: 35.5833 },
        { name: 'Douris', lat: 33.7833, lon: 35.9833 },
        { name: 'El Qaa', lat: 33.7500, lon: 36.0333 },
        { name: 'Ferzol', lat: 33.7500, lon: 35.7167 },
        { name: 'Haidab', lat: 33.6667, lon: 35.8333 },
        { name: 'Halbet el Jazine', lat: 33.6333, lon: 35.8333 },
        { name: 'Hammara', lat: 33.7167, lon: 35.9333 },
        { name: 'Haret el Fikani', lat: 33.5667, lon: 35.7667 },
        { name: 'Hazzerta', lat: 33.5667, lon: 35.7833 },
        { name: 'Hoch el Omara', lat: 33.5833, lon: 35.8167 },
        { name: 'Hoch Harime', lat: 33.6333, lon: 35.8667 },
        { name: 'Hosh Barada', lat: 33.8167, lon: 36.0167 },
        { name: 'Hosh el Rafika', lat: 33.8000, lon: 35.9833 },
        { name: 'Jabboule', lat: 33.8167, lon: 36.0333 },
        { name: 'Janta', lat: 33.9833, lon: 35.9833 },
        { name: 'Jdita', lat: 33.8333, lon: 35.9000 },
        { name: 'Joub Jannine', lat: 33.6275, lon: 35.7853 },
        { name: 'Kaa el Rim', lat: 33.8667, lon: 35.9000 },
        { name: 'Kafr Dan', lat: 33.5667, lon: 35.7667 },
        { name: 'Kafr Zabad', lat: 33.7167, lon: 35.8667 },
        { name: 'Karak', lat: 33.7333, lon: 35.8833 },
        { name: 'Kfar Meshki', lat: 33.8667, lon: 35.8333 },
        { name: 'Khraybe', lat: 33.6500, lon: 35.8500 },
        { name: 'Kleyaate', lat: 33.7167, lon: 35.9167 },
        { name: 'Laboué', lat: 33.8333, lon: 35.8667 },
        { name: 'Machgara', lat: 33.5167, lon: 35.6500 },
        { name: 'Majdal Anjar', lat: 33.7333, lon: 35.9167 },
        { name: 'Mansoura', lat: 33.8833, lon: 35.8833 },
        { name: 'Mariayoun', lat: 33.3667, lon: 35.5833 },
        { name: 'Mashghara', lat: 33.5333, lon: 35.6667 },
        { name: 'Mazraat Balde', lat: 33.6833, lon: 35.8500 },
        { name: 'Mazraat el Chouf', lat: 33.7000, lon: 35.7167 },
        { name: 'Mhaidse', lat: 33.5667, lon: 35.7667 },
        { name: 'Nabi Ayla', lat: 33.5667, lon: 35.7833 },
        { name: 'Nabi Chit', lat: 33.8667, lon: 35.9667 },
        { name: 'Nabi Osmane', lat: 33.5667, lon: 35.7833 },
        { name: 'Niha', lat: 33.6000, lon: 35.7333 },
        { name: 'Qabb Ilyas', lat: 33.7000, lon: 35.8000 },
        { name: 'Qab Elias', lat: 33.8000, lon: 35.8667 },
        { name: 'Qalaat esh Shqif', lat: 33.3167, lon: 35.5167 },
        { name: 'Qaraoun', lat: 33.5667, lon: 35.7167 },
        { name: 'Qousaya', lat: 33.5667, lon: 35.7333 },
        { name: 'Rayak', lat: 33.8500, lon: 36.0000 },
        { name: 'Riyaq', lat: 33.8500, lon: 36.0000 },
        { name: 'Saghbine', lat: 33.7000, lon: 35.7833 },
        { name: 'Saïdé', lat: 33.5667, lon: 35.7667 },
        { name: 'Saraain el Faouqa', lat: 33.8000, lon: 35.9333 },
        { name: 'Saraain et Tahta', lat: 33.8000, lon: 35.9333 },
        { name: 'Sohmor', lat: 33.5833, lon: 35.7833 },
        { name: 'Sultan Yaacoub', lat: 33.8167, lon: 35.9000 },
        { name: 'Taanayel', lat: 33.7333, lon: 35.7333 },
        { name: 'Taanayil', lat: 33.7333, lon: 35.7333 },
        { name: 'Talbiseh', lat: 34.3667, lon: 36.3667 },
        { name: 'Tamnine', lat: 33.5167, lon: 35.5667 },
        { name: 'Taalbaya', lat: 33.8500, lon: 35.9000 },
        { name: 'Tefahne', lat: 33.4167, lon: 35.4833 },
        { name: 'Terbol', lat: 33.8167, lon: 35.9833 },
        { name: 'Toula', lat: 34.1167, lon: 36.1167 },
        { name: 'Yammoune', lat: 34.1333, lon: 36.2333 },
        { name: 'Yanta', lat: 33.9833, lon: 35.9833 },
        { name: 'Zahle', lat: 33.8497, lon: 35.9042 },
        { name: 'Zebdine', lat: 33.6333, lon: 35.8667 }
        ],
        currentWeather: null,
        forecast: null,
        aiAdvisory: null,
        isDaytime: true,
        useFahrenheit: false,
        refreshing: false,
        errorMessage: '',
        map: null,
        markers: [],

        async init() {
            this.updateDate();
            this.initMap();
            await this.loadAllLocationsWeather();
            await this.loadWeatherData();
            this.initSwiper();
            this.setupHourlyForecastToggle();
            this.updateDayNight();
        },

        updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        },

        initMap() {
            this.map = L.map('map').setView([this.selectedLocation.lat, this.selectedLocation.lon], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(this.map);

            this.locations.forEach(location => {
                const marker = L.marker([location.lat, location.lon]).addTo(this.map);
                marker.bindPopup(`<b>${location.name}</b><br>Loading weather...`);
                this.markers.push(marker);
            });
        },

        async loadAllLocationsWeather() {
            for (let i = 0; i < this.locations.length; i++) {
                try {
                    const loc = this.locations[i];
                    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${loc.lat}&lon=${loc.lon}&appid=${this.apiKey}&units=metric`);
                    if (!res.ok) throw new Error('Weather fetch failed');
                    const data = await res.json();
                    data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                    data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                    loc.currentWeather = data;
                    this.markers[i].setPopupContent(`<b>${loc.name}</b><br>${Math.round(data.main.temp)}°C, ${data.weather[0].description}`);
                } catch(e) { console.error(e); }
            }
        },

        async loadWeatherData() {
            this.refreshing = true;
            this.errorMessage = '';
            try {
                // Current weather
                const resp = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!resp.ok) throw new Error('Current weather fetch failed');
                const data = await resp.json();
                data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                this.currentWeather = data;

                // Forecast
                const forecastResp = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!forecastResp.ok) throw new Error('Forecast fetch failed');
                const forecastData = await forecastResp.json();

                // Hourly (next 24h)
                this.forecast = {
                    hourly: forecastData.list.slice(0, 8).map(item => ({
                        dt: item.dt,
                        temp: Math.round(item.main.temp),
                        tempF: this.celsiusToFahrenheit(item.main.temp),
                        weather: item.weather
                    })),
                    daily: []
                };

                // Daily summary
                const days = {};
                forecastData.list.forEach(item => {
                    const date = new Date(item.dt * 1000).toLocaleDateString();
                    if (!days[date]) days[date] = [];
                    days[date].push(item);
                });
                for (const date in days) {
                    const items = days[date];
                    const temps = items.map(i => i.main.temp);
                    const tempMax = Math.max(...temps);
                    const tempMin = Math.min(...temps);
                    this.forecast.daily.push({
                        dt: items[0].dt,
                        temp: { max: Math.round(tempMax), min: Math.round(tempMin), maxF: this.celsiusToFahrenheit(tempMax), minF: this.celsiusToFahrenheit(tempMin) },
                        weather: items[0].weather
                    });
                }
                this.forecast.daily = this.forecast.daily.slice(0, 7);

                this.updateDayNightBasedOnTime(data.sys.sunrise, data.sys.sunset);
               
            } catch(e) {
                console.error(e);
                this.errorMessage = 'Failed to load weather data.';
            } finally {
                this.refreshing = false;
            }
        },

        celsiusToFahrenheit(c) { return Math.round(c * 9 / 5 + 32); },

        updateDayNight() {
            const h = new Date().getHours();
            this.isDaytime = h >= 6 && h < 18;
        },

        updateDayNightBasedOnTime(sunrise, sunset) {
            const now = Math.floor(Date.now() / 1000);
            this.isDaytime = now > sunrise && now < sunset;
        },

        getWeatherIcon(iconCode) {
            const map = {
                '01d': 'fas fa-sun','01n': 'fas fa-moon',
                '02d': 'fas fa-cloud-sun','02n': 'fas fa-cloud-moon',
                '03d': 'fas fa-cloud','03n': 'fas fa-cloud',
                '04d': 'fas fa-cloud','04n': 'fas fa-cloud',
                '09d': 'fas fa-cloud-showers-heavy','09n': 'fas fa-cloud-showers-heavy',
                '10d': 'fas fa-cloud-sun-rain','10n': 'fas fa-cloud-moon-rain',
                '11d': 'fas fa-bolt','11n': 'fas fa-bolt',
                '13d': 'fas fa-snowflake','13n': 'fas fa-snowflake',
                '50d': 'fas fa-smog','50n': 'fas fa-smog'
            };
            return map[iconCode] || 'fas fa-cloud';
        },

        getWeatherIconColor(iconCode) {
            if (iconCode.includes('01') || iconCode.includes('02')) return 'text-yellow-300';
            if (iconCode.includes('09') || iconCode.includes('10')) return 'text-blue-300';
            if (iconCode.includes('11')) return 'text-yellow-400';
            if (iconCode.includes('13')) return 'text-blue-100';
            return 'text-gray-300';
        },

        initSwiper() {
            new Swiper('.forecast-swiper', {
                slidesPerView: 2,
                spaceBetween: 15,
                pagination: { el: '.swiper-pagination', clickable: true },
                breakpoints: { 640:{slidesPerView:3},768:{slidesPerView:4},1024:{slidesPerView:5},1280:{slidesPerView:7} }
            });
        },

        setupHourlyForecastToggle() {
            document.getElementById('hourly-forecast-toggle').addEventListener('click', function(){
                const c = document.getElementById('hourly-forecast-content');
                const ch = document.getElementById('hourly-chevron');
                if (!c.style.maxHeight || c.style.maxHeight === '0px') { c.style.maxHeight='200px'; ch.style.transform='rotate(180deg)'; }
                else { c.style.maxHeight='0px'; ch.style.transform='rotate(0deg)'; }
            });
        },

        async selectLocation(location) {
            // window.location.href = `/weather?lat=${location.lat}&lon=${location.lon}`;
            this.selectedLocation = location;
            this.map.setView([location.lat, location.lon], 10);
            await this.loadWeatherData();
                       
        },



        
        async refreshWeather() {
            await this.loadWeatherData();
            await this.loadAllLocationsWeather();
            
        },

        getFarmingTip() {
            const tips = [
                'Consider planting drought-resistant crops during dry spells.',
                'Apply mulch to retain soil moisture during hot weather.',
                'Check irrigation systems for leaks and efficiency.',
                'Monitor crops for signs of heat stress during high temperatures.',
                'Plan planting schedules around expected rainfall patterns.',
                'Use row covers to protect young plants from unexpected cold snaps.'
            ];
            return tips[Math.floor(Math.random()*tips.length)];
        }
    };
}


document.addEventListener('DOMContentLoaded', () => {
    console.log('Weather app initialized.');
});
</script> 
</body>
</html>