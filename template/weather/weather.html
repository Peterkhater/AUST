<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard - FarmConnect AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js for interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        sky: {
                            day: {
                                light: '#38bdf8',
                                medium: '#0ea5e9',
                                dark: '#0284c7'
                            },
                            night: {
                                light: '#1e40af',
                                medium: '#1e3a8a',
                                dark: '#172554'
                            }
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.7s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/css">
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            background-color: black;
               background: linear-gradient(to bottom, #1e40af, #1e3a8a, #172554);
        }
        
        /* Animated sky background */
        .sky-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: all 1.5s ease;
        }
        
        .day-sky {
            /* background: linear-gradient(to bottom, #38bdf8, #0ea5e9, #0284c7); */
        }
        
        .night-sky {
            /* background: linear-gradient(to bottom, #1e40af, #1e3a8a, #172554); */
        }
        
        /* Cloud animation */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
        }
        
        .cloud-1 {
            width: 120px;
            height: 40px;
            top: 20%;
            left: 10%;
            animation: float 25s infinite ease-in-out;
        }
        
        .cloud-2 {
            width: 80px;
            height: 30px;
            top: 30%;
            right: 15%;
            animation: float 20s infinite ease-in-out;
            animation-delay: 2s;
        }
        
        .cloud-3 {
            width: 100px;
            height: 35px;
            top: 25%;
            left: 60%;
            animation: float 30s infinite ease-in-out;
            animation-delay: 5s;
        }
        
        /* Stars for night sky */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 4s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(30px) translateY(10px); }
            50% { transform: translateX(0) translateY(20px); }
            75% { transform: translateX(-30px) translateY(10px); }
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        /* Weather card styling */
        .weather-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Map container */
        #map {
            border-radius: 16px;
            overflow: hidden;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #16a34a;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #15803d;
        }
        
        /* Swiper customization */
        .swiper-pagination-bullet-active {
            background-color: white !important;
        }
        
        .swiper-slide {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white min-h-screen overflow-x-hidden" x-data="weatherApp()" x-init="init()">
    <!-- Animated Sky Background -->
    <div class="sky-background" :class="isDaytime ? 'day-sky' : 'night-sky'">
        <template x-if="isDaytime">
            <div>
                <div class="cloud cloud-1"></div>
                <div class="cloud cloud-2"></div>
                <div class="cloud cloud-3"></div>
            </div>
        </template>
        <template x-if="!isDaytime">
            <div>
                <div class="star" style="top: 15%; left: 20%; width: 2px; height: 2px; animation-delay: 0s;"></div>
                <div class="star" style="top: 25%; left: 50%; width: 3px; height: 3px; animation-delay: 1s;"></div>
                <div class="star" style="top: 10%; left: 70%; width: 2px; height: 2px; animation-delay: 2s;"></div>
                <div class="star" style="top: 30%; left: 30%; width: 2px; height: 2px; animation-delay: 0.5s;"></div>
                <div class="star" style="top: 20%; left: 80%; width: 3px; height: 3px; animation-delay: 1.5s;"></div>
                <div class="star" style="top: 35%; left: 60%; width: 2px; height: 2px; animation-delay: 2.5s;"></div>
            </div>
        </template>
    </div>
    
    <!-- Navigation -->
    <!-- <nav class="sticky top-0 w-full bg-white/10 backdrop-blur-sm z-50 py-4">
        <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
            <a href="#" class="flex items-center space-x-2">
                <span class="text-white">
                    <i class="fas fa-leaf text-2xl"></i>
                </span>
                <span class="font-bold text-xl text-white">FarmConnect<span class="text-primary-400">AI</span></span>
            </a>
            
            <div class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-200 hover:text-white transition">Home</a>
                <a href="#" class="text-gray-200 hover:text-white transition">Marketplace</a>
                <a href="#" class="text-white font-medium hover:text-primary-300 transition">Weather</a>
                <a href="#" class="text-gray-200 hover:text-white transition">For Farmers</a>
                <a href="#" class="text-gray-200 hover:text-white transition">Dashboard</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <button class="text-gray-200 hover:text-white transition" @click="isDaytime = !isDaytime">
                    <i class="fas fa-moon" x-show="isDaytime"></i>
                    <i class="fas fa-sun" x-show="!isDaytime"></i>
                </button>
                <div class="hidden md:flex items-center space-x-2">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </nav> -->
    

    <!-- Main Content -->
    <main class="container mx-auto px-4 md:px-6 py-8">
        <!-- Location & Time Toggle -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold" x-text="selectedLocation.name"></h1>
                <p class="text-gray-200" id="current-date">Loading date...</p>
            </div>
            
            <div class="mt-4 md:mt-0 flex items-center space-x-4">
                <div class="flex items-center bg-white/10 rounded-full px-4 py-2">
                    <span class="text-sm mr-2">C°</span>
                    <label class="toggle-switch">
                        <input type="checkbox" x-model="useFahrenheit">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="text-sm ml-2">F°</span>
                </div>
                
                <div class="flex items-center space-x-2">
                    <button class="bg-white/10 rounded-full p-2 hover:bg-white/20 transition" @click="refreshWeather" >
                        <i class="fas fa-sync-alt" :class="{'loading': refreshing}"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div x-show="errorMessage" class="bg-red-500/80 text-white p-4 rounded-lg mb-6" x-transition>
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span x-text="errorMessage"></span>
            </div>
        </div>
        
        <!-- Current Weather Card -->
        <div class="weather-card rounded-2xl p-8 mb-8 shadow-lg" x-show="currentWeather">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <div class="flex items-center justify-center md:justify-start">
                        <span class="text-7xl md:text-8xl font-light" x-text="useFahrenheit ? currentWeather.main.tempF : currentWeather.main.temp"></span>
                        <span class="text-4xl mt-4">°<span x-text="useFahrenheit ? 'F' : 'C'"></span></span>
                    </div>
                    <p class="text-xl capitalize mt-2" x-text="currentWeather.weather[0].description"></p>
                    <p class="text-gray-200">Feels like <span x-text="useFahrenheit ? currentWeather.main.feels_likeF : currentWeather.main.feels_like"></span>°</p>
                </div>
                
                <div class="text-8xl">
                    <i :class="getWeatherIcon(currentWeather.weather[0].icon)" :class="getWeatherIconColor(currentWeather.weather[0].icon)"></i>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 pt-8 border-t border-white/20">
                <div class="text-center">
                    <p class="text-gray-200">Wind</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.wind.speed} m/s`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Humidity</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.main.humidity}%`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Pressure</p>
                    <p class="text-xl font-semibold" x-text="`${currentWeather.main.pressure} hPa`"></p>
                </div>
                <div class="text-center">
                    <p class="text-gray-200">Visibility</p>
                    <p class="text-xl font-semibold" x-text="`${(currentWeather.visibility / 1000).toFixed(1)} km`"></p>
                </div>
            </div>
        </div>
        
        <!-- Weekly Forecast -->
        <div class="mb-8" x-show="forecast">
            <h2 class="text-2xl font-bold mb-4">7-Day Forecast</h2>
            
            <!-- Swiper Forecast -->
            <div class="swiper forecast-swiper">
                <div class="swiper-wrapper">
                    <template x-for="(day, index) in forecast.daily" :key="index">
                        <div class="swiper-slide weather-card rounded-2xl p-4 text-center">
                            <p class="font-semibold mb-2" x-text="new Date(day.dt * 1000).toLocaleDateString('en-US', {weekday: 'short'})"></p>
                            <div class="text-3xl mb-2">
                                <i :class="getWeatherIcon(day.weather[0].icon)" :class="getWeatherIconColor(day.weather[0].icon)"></i>
                            </div>
                            <div class="flex justify-center space-x-3">
                                <span x-text="useFahrenheit ? day.temp.maxF : day.temp.max"></span>
                                <span class="text-gray-300" x-text="useFahrenheit ? day.temp.minF : day.temp.min"></span>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="swiper-pagination mt-4"></div>
            </div>
        </div>
        
        <!-- Map & Locations -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Map Container -->
            <div class="order-2 lg:order-1">
                <h2 class="text-2xl font-bold mb-4">Bekaa Region</h2>
                <div id="map" class="h-96 rounded-2xl"></div>
            </div>
            
            <!-- Location List -->
            <div class="order-1 lg:order-2">
                <h2 class="text-2xl font-bold mb-4">Locations</h2>
                <div class="space-y-4" style="overflow-y: scroll; max-height: 380px;">
                    <template x-for="(location, index) in locations" :key="index">
                        <div class="weather-card rounded-2xl p-4 cursor-pointer transition hover:bg-white/10" 
                             @click="selectLocation(location)"
                             :class="{ 'bg-white/10': selectedLocation.name === location.name }">
                            <div class="flex justify-between items-center">
                                <span x-text="location.name"></span>
                                <div class="flex items-center" x-show="location.currentWeather">
                                    <span class="text-xl mr-2" x-text="useFahrenheit ? location.currentWeather.main.tempF : location.currentWeather.main.temp"></span>
                                    <i :class="getWeatherIcon(location.currentWeather.weather[0].icon)" :class="getWeatherIconColor(location.currentWeather.weather[0].icon)"></i>
                                    
                                </div>
                                <div x-show="!location.currentWeather" class="loading"></div>
                            </div>
                        </div>
                    </template>
                </div>
                
                
            </div>
        </div>
        
        <!-- Hourly Forecast (Collapsible) -->
        <div class="weather-card rounded-2xl p-6 mt-8" x-show="forecast">
            <div class="flex justify-between items-center cursor-pointer" id="hourly-forecast-toggle">
                <h2 class="text-2xl font-bold">24-Hour Forecast</h2>
                <i class="fas fa-chevron-down transition-transform" id="hourly-chevron"></i>
            </div>
            
            <div class="mt-4 overflow-hidden transition-all duration-300" id="hourly-forecast-content" style="max-height: 0px;">
                <div class="flex overflow-x-auto pb-4 space-x-4 pt-2">
                    <template x-for="(hour, index) in forecast.hourly.slice(0, 24)" :key="index">
                        <div class="flex-shrink-0 text-center">
                            <p class="text-sm" x-text="new Date(hour.dt * 1000).toLocaleTimeString('en-US', {hour: 'numeric'})"></p>
                            <i :class="getWeatherIcon(hour.weather[0].icon)" :class="getWeatherIconColor(hour.weather[0].icon)" class="text-2xl my-2"></i>
                            <p class="font-semibold" x-text="useFahrenheit ? hour.tempF : hour.temp"></p>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </main>





<div class="weather-card rounded-2xl p-6 mb-8 mx-10">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-seedling text-primary-400 mr-2"></i>AI Farming Advisory
                <form action="" method="post"  class="mx-4">
                {%csrf_token%}
            <button type="submit" class="px-6 py-2 rounded-2xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 
         text-white font-semibold shadow-md hover:shadow-lg 
         hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 
         focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-400 
         transition-all duration-300 ease-in-out">Get Ai Advise</button>
            </form>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Watering Advice -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-tint text-2xl mr-3 text-blue-400"></i>
                        <h3 class="text-lg font-semibold">Watering Advice</h3>
                    </div>
                    <p>{{ ai_advisory.watering }}</p>
                </div>
                
                <!-- Fertilization Advice -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-flask text-2xl mr-3 text-green-400"></i>
                        <h3 class="text-lg font-semibold">Fertilization Advice</h3>
                    </div>
                    <p>{{ ai_advisory.fertilization }}</p>
                </div>
                
                <!-- Pest Risk -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-bug text-2xl mr-3 text-red-400"></i>
                        <h3 class="text-lg font-semibold">Pest Risk</h3>
                    </div>
                    <p>{{ ai_advisory.pest_risk }}</p>
                </div>
                
                <!-- Harvest Tips -->
                <div class="p-4 rounded-lg bg-[rgba(0,128,0,0.3)]" style="border-left: 6px rgb(88, 218, 88) solid; border-radius:15px ; ">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-scythe text-2xl mr-3 text-amber-400"></i>
                        <h3 class="text-lg font-semibold">Harvest Tips</h3>
                    </div>
                    <p>{{ ai_advisory.harvest }}</p>
                </div>
            </div>
        </div>

                            

       <!-- Alerts Section -->
<!-- Show this section only if there are alerts -->
{% if ai_advisory.weather_alerts %}
    <div class="weather-card rounded-2xl p-6 mb-8 mx-8">
        <h2 class="text-2xl font-bold mb-4 flex items-center ">
            <i class="fas fa-bell text-amber-400 mr-2"></i>Ai Weather Alerts
        </h2>
        
        <div class="grid grid-cols-1 gap-4">
            <!-- Loop through each alert in the list -->
            {% for alert in ai_advisory.weather_alerts %}
                
                <div class="p-4 rounded-lg flex items-start border-l-4 border-red-500 text-red-700 bg-[rgba(225,80,80,0.3)]">
                    <i class="fas fa-exclamation-triangle text-xl mt-1 mr-3"></i>
                    <div>
                        <h3 class="font-semibold text-white">{{ alert.title }}</h3>
                        <p class="text-sm mt-1 text-white">{{ alert.description }}</p>
                        <p class="text-xs text-gray mt-2">{{ alert.time }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% else %}
    <!-- Display a message if no alerts are found -->
    <div class="weather-card rounded-2xl p-6 mb-8 text-center text-gray-500">
        <p>No specific weather alerts at this time.</p>
    </div>
{% endif %}


    <!-- Footer -->
    <footer class="bg-white/5 mt-16 py-10">
        <div class="container mx-auto px-4 md:px-6">
            <div class="text-center">
                <div class="flex items-center justify-center mb-6">
                    <span class="text-primary-400 mr-2">
                        <i class="fas fa-leaf text-2xl"></i>
                    </span>
                    <span class="font-bold text-xl text-white">FarmConnect<span class="text-primary-400">AI</span></span>
                </div>
                <p class="text-gray-300 mb-6">Providing accurate weather forecasts for farmers in the Bekaa Valley</p>
                <div class="flex justify-center space-x-6">
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
                <p class="text-gray-400 text-sm mt-6">© 2023 FarmConnect AI. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

<script>
function weatherApp() {
    return {
        apiKey:"{{weather_api}}",
        defaultLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        selectedLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        locations: [
            { name: "Aabd el Fattah", lat: 33.67, lon: 35.85 },
            { name: "Aaita el Foukhar", lat: 33.64, lon: 35.91 },
            { name: "Aaitanit", lat: 33.56, lon: 35.67 },
            { name: "Aali enn Nahri", lat: 33.86, lon: 36.03 },
            { name: "Aammîq", lat: 33.71, lon: 35.76 },
            { name: "Aanjar", lat: 33.73, lon: 35.93 },
            { name: "Aaramta", lat: 33.79, lon: 35.98 },
            { name: "Aaz el Arab", lat: 33.52, lon: 35.80 },
            { name: "Aaïha", lat: 33.50, lon: 35.88 },
            { name: "Ablah", lat: 33.87, lon: 35.97 },
            { name: "Ad Dakwah", lat: 33.69, lon: 35.88 },
            { name: "Ad Dalhamīyah", lat: 33.82, lon: 35.96 },
            { name: "Ain Aata", lat: 33.43, lon: 35.78 },
            { name: "Ain Ennakri", lat: 33.86, lon: 36.03 },
            { name: "Ain Horche", lat: 33.46, lon: 35.78 },
            { name: "Ain Zebde", lat: 33.62, lon: 35.70 },
            { name: "Ain el Ghmiqa", lat: 33.83, lon: 35.82 },
            { name: "Ain et Tine", lat: 33.50, lon: 35.64 },
            { name: "Akbe", lat: 33.51, lon: 35.82 },
            { name: "Al Akramiyah", lat: 33.72, lon: 35.92 },
            { name: "Al Bayyadah", lat: 33.50, lon: 35.65 },
            { name: "Al Bayāḑah", lat: 33.82, lon: 35.84 },
            { name: "Al Bīrah", lat: 33.58, lon: 35.82 },
            { name: "Al Fa`ur", lat: 33.78, lon: 35.97 },
            { name: "Al Furzul", lat: 33.88, lon: 35.95 },
            { name: "Al Ghābah", lat: 33.85, lon: 35.97 },
            { name: "Al Hammar", lat: 33.87, lon: 35.90 },
            { name: "Al Hara'iq", lat: 33.82, lon: 36.00 },
            { name: "Al Hilwah", lat: 33.61, lon: 36.00 },
            { name: "Al Istabil", lat: 33.75, lon: 35.88 },
            { name: "Al Jawzah", lat: 33.85, lon: 35.82 },
            { name: "Al Jazirah", lat: 33.72, lon: 35.85 },
            { name: "Al Khiyārah", lat: 33.69, lon: 35.85 },
            { name: "Al Mallāḩah", lat: 33.83, lon: 35.83 },
            { name: "Al Manşūrah", lat: 33.68, lon: 35.81 },
            { name: "Al Marj", lat: 33.76, lon: 35.88 },
            { name: "Al Mu`allaqah", lat: 33.84, lon: 35.92 },
            { name: "Al Muhaytah", lat: 33.56, lon: 35.81 },
            { name: "Al Murayjāt", lat: 33.81, lon: 35.82 },
            { name: "Al Muzayyanah", lat: 33.79, lon: 35.82 },
            { name: "Al Mīdān", lat: 33.85, lon: 35.91 },
            { name: "Al Qan`abah", lat: 33.48, lon: 35.77 },
            { name: "Al Qar‘awn", lat: 33.56, lon: 35.72 },
            { name: "Al Qati`", lat: 33.85, lon: 35.86 },
            { name: "Al Qaşr", lat: 33.72, lon: 35.76 },
            { name: "Al Wādī", lat: 33.84, lon: 35.86 },
            { name: "Al `Ammuri", lat: 33.81, lon: 35.87 },
            { name: "Al Ḩawsh", lat: 33.48, lon: 35.75 },
            { name: "Al Ḩārah", lat: 33.85, lon: 35.86 },
            { name: "Ali en Nahri", lat: 33.86, lon: 36.03 },
            { name: "Amnik", lat: 33.71, lon: 35.76 },
            { name: "An Na`sat", lat: 33.81, lon: 35.84 },
            { name: "An Nab`at", lat: 33.49, lon: 35.75 },
            { name: "An Nabī Aylā", lat: 33.88, lon: 35.96 },
            { name: "An Naqbah", lat: 33.81, lon: 35.84 },
            { name: "An Nasiriyah", lat: 33.86, lon: 36.06 },
            { name: "Andžaras", lat: 33.73, lon: 35.93 },
            { name: "Ar Rafid", lat: 33.57, lon: 35.82 },
            { name: "Ar Ramtaniyah", lat: 33.84, lon: 35.82 },
            { name: "Ar Rumayl", lat: 33.65, lon: 35.79 },
            { name: "Aradi el Aaqabe", lat: 33.62, lon: 35.73 },
            { name: "Ard", lat: 33.82, lon: 35.86 },
            { name: "As Safrah", lat: 33.75, lon: 35.80 },
            { name: "As Sawirah", lat: 33.69, lon: 35.91 },
            { name: "As Sultan Ya`qub", lat: 33.64, lon: 35.86 },
            { name: "As Surayj", lat: 33.80, lon: 35.82 },
            { name: "Ash Shabraqīyah", lat: 33.78, lon: 35.87 },
            { name: "At Tuwaytah", lat: 33.86, lon: 35.85 },
            { name: "Az Zarub", lat: 33.58, lon: 35.81 },
            { name: "Az Zu‘rūrah", lat: 33.81, lon: 35.87 },
            { name: "Aâna", lat: 33.69, lon: 35.75 },
            { name: "Aïn Aarab", lat: 33.58, lon: 35.87 },
            { name: "Aïn Herché", lat: 33.46, lon: 35.78 },
            { name: "Aïn Kafer Zabad", lat: 33.79, lon: 35.99 },
            { name: "Aïn Kfar Zabad", lat: 33.80, lon: 36.01 },
            { name: "Aïn el Laboué", lat: 33.52, lon: 35.82 },
            { name: "Aïtanît", lat: 33.56, lon: 35.67 },
            { name: "Baaloul", lat: 33.59, lon: 35.75, elev_ft: 4340, pop_est: 0 },
            { name: "Bab Mare", lat: 33.58, lon: 35.68, elev_ft: 2732, pop_est: 7979 },
            { name: "Bakka", lat: 33.59, lon: 35.92, elev_ft: 5029, pop_est: 61 },
            { name: "Bakkeefa", lat: 33.49, lon: 35.82, elev_ft: 3349, pop_est: 18841 },
            { name: "Bar Elias", lat: 33.77, lon: 35.90, elev_ft: 2887, pop_est: 94659 },
            { name: "Barbara", lat: 33.85, lon: 35.90, elev_ft: 3349, pop_est: 40994 },
            { name: "Bouarej", lat: 33.82, lon: 35.82, elev_ft: 3402, pop_est: 28367 },
            { name: "Bayt Lahiyah", lat: 33.48, lon: 35.80, elev_ft: 3349, pop_est: 10865 },
            { name: "Behinna", lat: 33.91, lon: 35.88, elev_ft: 5029, pop_est: 32247 },
            { name: "Beit Zakhour", lat: 33.82, lon: 35.87, elev_ft: 3349, pop_est: 55083 },
            { name: "Beït Zakhoûr", lat: 33.83, lon: 35.87, elev_ft: 3349, pop_est: 44786 },
            { name: "Bou Frès", lat: 33.55, lon: 35.70, elev_ft: 2795, pop_est: 174 },
            { name: "Bou Zaher", lat: 33.64, lon: 35.72, elev_ft: 3349, pop_est: 3729 },
            { name: "Bsouje", lat: 33.91, lon: 35.87, elev_ft: 5029, pop_est: 40814 },
            { name: "Chebrqiyé", lat: 33.78, lon: 35.87, elev_ft: 2883, pop_est: 91225 },
  { name: "Chtaura", lat: 33.82, lon: 35.85, elev_ft: 3349, pop_est: 44013 },
   { name: "Dahr as Sawwan", lat: 33.81, lon: 35.85, elev_ft: 3349, pop_est: 44143 },
  { name: "Dahr el Ahmar", lat: 33.53, lon: 35.84, elev_ft: 4189, pop_est: 23971 },
  { name: "Dahr el Blait", lat: 33.83, lon: 35.85, elev_ft: 3372, pop_est: 40021 },
  { name: "Dalhamiyah", lat: 33.82, lon: 35.96, elev_ft: 2923, pop_est: 34451 },
  { name: "Dallafah", lat: 33.43, lon: 35.65, elev_ft: 2509, pop_est: 3762 },
  { name: "Darzanoun", lat: 33.75, lon: 35.92, elev_ft: 2874, pop_est: 93186 },
  { name: "Deir Tahnish", lat: 33.70, lon: 35.76, elev_ft: 2874, pop_est: 5639 },
  { name: "Deir Ayn al Jawzah", lat: 33.60, lon: 35.69, elev_ft: 2732, pop_est: 7154 },
  { name: "Deir al Ghazal", lat: 33.82, lon: 36.03, elev_ft: 3464, pop_est: 29095 },
  { name: "Deir al Achaair", lat: 33.56, lon: 36.01, elev_ft: 4189, pop_est: 2232 },
  { name: "Deir Zenoun", lat: 33.75, lon: 35.92, elev_ft: 2874, pop_est: 93186 },
  { name: "Djeb Djennin", lat: 33.63, lon: 35.78, elev_ft: 3349, pop_est: 0 },
  { name: "Djedita", lat: 33.82, lon: 35.84, elev_ft: 3375, pop_est: 34994 },
  { name: "Djezirah", lat: 33.72, lon: 35.85, elev_ft: 2883, pop_est: 57975 },
 { name: "Ed Dakoué", lat: 33.69, lon: 35.88 },
  { name: "Ed Dalhamîyé", lat: 33.82, lon: 35.96 },
  { name: "Ej Jaouzé", lat: 33.85, lon: 35.82 },
  { name: "Ej Jezire", lat: 33.72, lon: 35.85 },
  { name: "El Aammoûri", lat: 33.81, lon: 35.87 },
  { name: "El Aaouja", lat: 33.53, lon: 35.66 },
  { name: "El Aaqabe", lat: 33.51, lon: 35.82 },
  { name: "El Akramîyé", lat: 33.72, lon: 35.92 },
  { name: "El Baiyada", lat: 33.50, lon: 35.65 },
  { name: "El Bayad", lat: 33.82, lon: 36.01 },
  { name: "El Baïyâra", lat: 33.43, lon: 35.65 },
  { name: "El Biyâda", lat: 33.82, lon: 35.84 },
  { name: "El Bîré", lat: 33.58, lon: 35.82 },
  { name: "El Establ", lat: 33.75, lon: 35.88 },
  { name: "El Faqaa", lat: 33.46, lon: 35.82 },
  { name: "El Fourzol", lat: 33.88, lon: 35.95 },
  { name: "El Fâaoûr", lat: 33.78, lon: 35.97 },
  { name: "El Ghabe", lat: 33.85, lon: 35.97 },
  { name: "El Ghaberi", lat: 33.54, lon: 35.68 },
  { name: "El Hammari", lat: 33.58, lon: 35.72 },
  { name: "El Haouch", lat: 33.48, lon: 35.75 },
  { name: "El Hara", lat: 33.85, lon: 35.86 },
  { name: "El Harqât", lat: 33.86, lon: 35.91 },
  { name: "El Harâyeq", lat: 33.82, lon: 36.00 },
  { name: "El Heloue", lat: 33.61, lon: 36.00 },
  { name: "El Hemmar", lat: 33.87, lon: 35.90 },
  { name: "El Houssiâne", lat: 33.58, lon: 35.70 },
  { name: "El Karak", lat: 33.85, lon: 35.93 },
  { name: "El Khiâra", lat: 33.69, lon: 35.85 },
  { name: "El M`allaqah", lat: 33.84, lon: 35.92 },
  { name: "El Mannsoura", lat: 33.68, lon: 35.81 },
  { name: "El Marj", lat: 33.76, lon: 35.88 },
  { name: "El Mazraat", lat: 33.47, lon: 35.77 },
  { name: "El Mhatta", lat: 33.83, lon: 35.83 },
  { name: "El Mhaïdthé", lat: 33.56, lon: 35.81 },
  { name: "El Midane", lat: 33.85, lon: 35.91 },
  { name: "El Mraïjât", lat: 33.81, lon: 35.82 },
  { name: "El Mzaiyani", lat: 33.79, lon: 35.82 },
  { name: "El Obaïr", lat: 33.58, lon: 35.70 },
  { name: "El Ouaar", lat: 33.47, lon: 35.64 },
  { name: "El Ouatié", lat: 33.50, lon: 35.65 },
  { name: "El Ouâdi", lat: 33.84, lon: 35.86 },
  { name: "El Qar‘aun", lat: 33.56, lon: 35.72 },
  { name: "El Qasr", lat: 33.72, lon: 35.76 },
  { name: "El Qasr (South)", lat: 33.64, lon: 35.71 },
  { name: "El Qennah`bah", lat: 33.48, lon: 35.77 },
  { name: "El Qilya", lat: 33.44, lon: 35.66 },
  { name: "El Qinnaabé", lat: 33.48, lon: 35.77 },
  { name: "El Qâtiaa", lat: 33.85, lon: 35.86 },
  { name: "El-Jazeerah", lat: 33.72, lon: 35.85 },
  { name: "En Naassat", lat: 33.81, lon: 35.84 },
  { name: "En Nabaat", lat: 33.49, lon: 35.75 },
  { name: "En Nabi Ayla", lat: 33.88, lon: 35.96 },
  { name: "En Naqbé", lat: 33.81, lon: 35.84 },
  { name: "En Nasriyah", lat: 33.86, lon: 36.06 },
  { name: "En Nâhrîyé", lat: 33.78, lon: 35.84 },
  { name: "Er Rafîd", lat: 33.57, lon: 35.82 },
  { name: "Er Ramtânîyé", lat: 33.84, lon: 35.82 },
  { name: "Er Rmaïl", lat: 33.65, lon: 35.79 },
  { name: "Es Safra", lat: 33.75, lon: 35.80 },
  { name: "Es Saouire", lat: 33.69, lon: 35.91 },
  { name: "Es Soultane Yaaqoub", lat: 33.64, lon: 35.86 },
  { name: "Es Sraïj", lat: 33.80, lon: 35.82 },
  { name: "Es-Samah", lat: 33.50, lon: 35.80 },
  { name: "Es-Sultan Ya`qoub el-Fauqa", lat: 33.64, lon: 35.86 },
  { name: "Es-Sultan Ya`qoub et-Tahta", lat: 33.64, lon: 35.84 },
  { name: "Et-Tweitah", lat: 33.86, lon: 35.85 },
  { name: "Ez Zaaroûra", lat: 33.81, lon: 35.87 },
  { name: "Ez Zâroûb", lat: 33.58, lon: 35.81 },
         { name: "Faouq el Bîr", lat: 33.67, lon: 35.83 },
  { name: "Foht Hima Hassan", lat: 33.46, lon: 35.83 },
  { name: "Fourzol", lat: 33.88, lon: 35.95 },
  { name: "Ghazzah", lat: 33.67, lon: 35.83 },
   { name: "Hai el-Fikani", lat: 33.85, lon: 36.03 },
  { name: "Haloua", lat: 33.61, lon: 36.00 },
  { name: "Hammarah", lat: 33.65, lon: 35.89 },
  { name: "Hamoui", lat: 33.85, lon: 35.86 },
  { name: "Hansh Mousa", lat: 33.73, lon: 35.93 },
  { name: "Haouch", lat: 33.48, lon: 35.75 },
  { name: "Haouch Aammik", lat: 33.72, lon: 35.78 },
  { name: "Haouch Hala", lat: 33.85, lon: 35.99 },
  { name: "Haouch Mandara", lat: 33.78, lon: 35.86 },
  { name: "Haouch Moch", lat: 33.82, lon: 36.02 },
  { name: "Haouch Qaïssar", lat: 33.77, lon: 35.81 },
  { name: "Haouch Rhanem", lat: 33.87, lon: 36.03 },
  { name: "Haouch el Harime", lat: 33.72, lon: 35.86 },
  { name: "Haouch el Omara", lat: 33.84, lon: 35.90 },
  { name: "Haouch es Siyâdi", lat: 33.77, lon: 35.83 },
  { name: "Haouch ez Zaraane", lat: 33.85, lon: 35.91 },
  { name: "Haoush Mousa", lat: 33.73, lon: 35.93 },
  { name: "Haql Hammana", lat: 33.87, lon: 35.84 },
  { name: "Haql al `Ayn", lat: 33.82, lon: 35.87 },
  { name: "Harat al Fawqa", lat: 33.83, lon: 35.83 },
  { name: "Haret el Faouqa", lat: 33.82, lon: 35.82 },
  { name: "Haret el Fikâni", lat: 33.85, lon: 36.03 },
  { name: "Haret el Kaouasbé", lat: 33.50, lon: 35.84 },
  { name: "Haret et Tahta", lat: 33.82, lon: 35.81 },
  { name: "Haush Hala", lat: 33.85, lon: 35.99 },
  { name: "Haush `Ammeeq", lat: 33.72, lon: 35.78 },
  { name: "Haush el-Ghanam", lat: 33.87, lon: 36.03 },
  { name: "Haush el-Umara", lat: 33.84, lon: 35.90 },
  { name: "Hawsh Hala", lat: 33.85, lon: 35.99 },
  { name: "Hawsh Qaysar", lat: 33.77, lon: 35.81 },
  { name: "Hawsh `Ammiq", lat: 33.72, lon: 35.78 },
  { name: "Hawsh ad Dibs", lat: 33.76, lon: 35.81 },
  { name: "Hawsh adh Dhunaybah", lat: 33.48, lon: 35.75 },
  { name: "Hawsh al Mandarah", lat: 33.78, lon: 35.86 },
  { name: "Hawsh al Umara'", lat: 33.84, lon: 35.90 },
  { name: "Hawsh as Sayyadah", lat: 33.77, lon: 35.83 },
  { name: "Hawsh az Zara`inah", lat: 33.85, lon: 35.91 },
  { name: "Hayy Ja`ir", lat: 33.80, lon: 35.82 },
  { name: "Hayy al Ba`l", lat: 33.82, lon: 35.87 },
  { name: "Hayy al Jami`", lat: 33.82, lon: 35.87 },
  { name: "Hazerta", lat: 33.88, lon: 35.87 },
  { name: "Haï Jaaïr", lat: 33.80, lon: 35.82 },
  { name: "Haï Mâr Eliâs", lat: 33.82, lon: 35.87 },
  { name: "Haï ed Dhaïni", lat: 33.82, lon: 35.87 },
  { name: "Haï ej Jâmia", lat: 33.82, lon: 35.87 },
  { name: "Haï el Baal", lat: 33.82, lon: 35.87 },
  { name: "Hbâq el Hebâs", lat: 33.61, lon: 35.73 },
  { name: "Hishmush", lat: 33.82, lon: 36.02 },
  { name: "Hizzirta", lat: 33.88, lon: 35.87 },
  { name: "Hoch Moch", lat: 33.82, lon: 36.02 },
  { name: "Hosaya", lat: 33.81, lon: 36.02 },
  { name: "Hoshmosh", lat: 33.82, lon: 36.02 },
  { name: "Hushmush", lat: 33.82, lon: 36.02 },
   { name: "Istabl", lat: 33.75, lon: 35.88 },
   { name: "Jaafar", lat: 33.47, lon: 35.77 },
  { name: "Jadita", lat: 33.82, lon: 35.84 },
  { name: "Jalâla", lat: 33.82, lon: 35.86 },
  { name: "Jebb Farah", lat: 33.52, lon: 35.79 },
  { name: "Joub Jannine", lat: 33.63, lon: 35.78 },
  { name: "Judaydat Yabus", lat: 33.67, lon: 35.93 },
   { name: "KFARZABAD", lat: 33.79, lon: 35.99 },
  { name: "Kafr Danīs", lat: 33.55, lon: 35.85 },
  { name: "Kafr Mishki", lat: 33.52, lon: 35.77 },
  { name: "Kafr Qūq", lat: 33.53, lon: 35.89 },
  { name: "Kamed Al Lawz", lat: 33.62, lon: 35.82 },
  { name: "Karak Nuh", lat: 33.85, lon: 35.93 },
  { name: "Kawkaba Bu `Arab", lat: 33.53, lon: 35.78 },
  { name: "Kefraïya", lat: 33.67, lon: 35.73 },
  { name: "Khallet Im Sleimane", lat: 33.83, lon: 35.85 },
  { name: "Khirbat Qanāfār", lat: 33.64, lon: 35.72 },
  { name: "Khirbat Rūḩā", lat: 33.57, lon: 35.85 },
  { name: "Khommaret Jraissati", lat: 33.83, lon: 35.87 },
  { name: "Kouaa el Armane", lat: 33.51, lon: 35.84 },
  { name: "Kroûm ed Daïaa", lat: 33.80, lon: 35.83 },
  { name: "Ksar al Hanash", lat: 33.75, lon: 35.88 },
   { name: "Lebbaya", lat: 33.48, lon: 35.72 },
  { name: "Loûssi", lat: 33.65, lon: 35.84 },
  { name: "Lâla", lat: 33.60, lon: 35.76 },
   { name: "Ma`zar", lat: 33.58, lon: 35.97 },
  { name: "Maallaqa", lat: 33.84, lon: 35.92 },
  { name: "Machghara", lat: 33.53, lon: 35.65 },
  { name: "Maidoun", lat: 33.47, lon: 35.64 },
  { name: "Majdal `Anjar", lat: 33.71, lon: 35.90 },
  { name: "Maksah", lat: 33.81, lon: 35.83 },
  { name: "Mansoûra", lat: 33.68, lon: 35.81 },
  { name: "Mar Ilyas", lat: 33.84, lon: 35.89 },
  { name: "Marj Aali", lat: 33.86, lon: 35.96 },
  { name: "Marj as Samāḩ", lat: 33.50, lon: 35.80 },
  { name: "Mazra`at Dayr al `Asha'ir", lat: 33.58, lon: 36.01 },
  { name: "Mazra`at Ja`far", lat: 33.47, lon: 35.77 },
  { name: "Mazra`at `Ayn Qaniyah", lat: 33.62, lon: 35.90 },
  { name: "Mazra`at `Azzah", lat: 33.61, lon: 35.84 },
  { name: "Mazra`at al Qalyun", lat: 33.61, lon: 35.91 },
  { name: "Mazra`at ash Shumayyisah", lat: 33.52, lon: 35.73 },
  { name: "Mazraat", lat: 33.48, lon: 35.86 },
  { name: "Mdoûkha", lat: 33.61, lon: 35.88 },
  { name: "Morh el Ouaarât", lat: 33.60, lon: 36.02 },
  { name: "Mraymis", lat: 33.47, lon: 35.76 },
  { name: "Mrâh ej Jammâl", lat: 33.58, lon: 35.95 },
  { name: "Mâssa", lat: 33.85, lon: 36.07 },
  { name: "Nab` al `Asal", lat: 33.83, lon: 35.82 },
  { name: "Nabat", lat: 33.49, lon: 35.75 },
  { name: "Nabi Ayla", lat: 33.88, lon: 35.96 },
  { name: "Nasriye", lat: 33.86, lon: 36.06 },
  { name: "Niha", lat: 33.89, lon: 35.97 },
   { name: "Ouadaï ed Dâher", lat: 33.80, lon: 35.80 },
  { name: "Ouadi el Aarayech", lat: 33.86, lon: 35.90 },
  { name: "Ouataya Bou Hamze", lat: 33.82, lon: 35.82 },
  { name: "Qa`ar Rim", lat: 33.88, lon: 35.88 },
  { name: "Qabb Elias", lat: 33.80, lon: 35.82 },
  { name: "Qamar ed Dine", lat: 33.86, lon: 35.90 },
  { name: "Qana`bah", lat: 33.48, lon: 35.77 },
  { name: "Qaraaoun", lat: 33.56, lon: 35.72 },
  { name: "Qasr", lat: 33.64, lon: 35.71 },
  { name: "Qelia", lat: 33.44, lon: 35.66 },
  { name: "Qommol", lat: 33.84, lon: 35.86 },
  { name: "Qoussaya", lat: 33.81, lon: 36.02 },
   { name: "R`it", lat: 33.83, lon: 36.04 },
  { name: "Ra'siyah", lat: 33.85, lon: 35.89 },
  { name: "Rachaiya", lat: 33.50, lon: 35.84 },
  { name: "Rayak", lat: 33.85, lon: 36.00 },
   { name: "Sehmour", lat: 33.52, lon: 35.69 },
  { name: "Soultan Yaakoub", lat: 33.64, lon: 35.86 },
  { name: "Saad Nayil", lat: 33.82, lon: 35.88 },
  { name: "Saghbin", lat: 33.61, lon: 35.70 },
  { name: "Sahm at Tawbah", lat: 33.86, lon: 36.02 },
  { name: "Sahm ej Jaras", lat: 33.66, lon: 35.75 },
  { name: "Sahrat al Qashsh", lat: 33.79, lon: 35.82 },
  { name: "Saouiri", lat: 33.69, lon: 35.91 },
  { name: "Shtawrah", lat: 33.82, lon: 35.85 },
  { name: "Talabaya", lat: 33.81, lon: 35.86 },
  { name: "Tanayil", lat: 33.80, lon: 35.87 },
  { name: "Tall Dhnub", lat: 33.66, lon: 35.78 },
  { name: "Tall Dhnub al Jadidah", lat: 33.67, lon: 35.77 },
  { name: "Tall al Akhdar", lat: 33.73, lon: 35.83 },
  { name: "Tall az Zaazi", lat: 33.67, lon: 35.85 },
  { name: "Tallat al Jammas", lat: 33.74, lon: 35.92 },
  { name: "Tannoura", lat: 33.47, lon: 35.80 },
  { name: "Tariq ej Jdide", lat: 33.80, lon: 35.83 },
  { name: "Tell Kamid el-Loz", lat: 33.62, lon: 35.82 },
  { name: "Tell Znoub", lat: 33.66, lon: 35.78 },
  { name: "Tell Znoûb ej Jdide", lat: 33.67, lon: 35.77 },
  { name: "Tell el Akhdar", lat: 33.73, lon: 35.83 },
  { name: "Tell ez Zaazeaa", lat: 33.67, lon: 35.85 },
  { name: "Tellet ej Jemmas", lat: 33.74, lon: 35.92 },
  { name: "Terbol", lat: 33.82, lon: 35.98 },
  { name: "Thulthata", lat: 33.50, lon: 35.75 },
  { name: "Timray", lat: 33.52, lon: 35.66 },
  { name: "Touaite", lat: 33.86, lon: 35.85 },
  { name: "Toultata", lat: 33.50, lon: 35.75 },
  { name: "Turbul", lat: 33.82, lon: 35.98 },
   { name: "Wadi ad Dahr", lat: 33.80, lon: 35.80 },
  { name: "Wadi ad Dalam", lat: 33.80, lon: 35.80 },
  { name: "Wadi al Ara'ish", lat: 33.86, lon: 35.90 },
  { name: "Wataya Bu Hamzah", lat: 33.82, lon: 35.82 },
  { name: "Yanta", lat: 33.60, lon: 35.94 },
  { name: "Yohmor el Beqaa", lat: 33.49, lon: 35.67 },
  { name: "Zahle", lat: 33.85, lon: 35.90 },
  { name: "Zebdol", lat: 33.82, lon: 35.84 },
  { name: "Zellaya", lat: 33.46, lon: 35.67 }
        ],
        // locations: [
        //     { name: 'Ain Zebde', lat: 33.6333, lon: 35.8667 },
        // { name: 'Al Ain', lat: 33.7333, lon: 35.8833 },
        // { name: 'Amik', lat: 33.9833, lon: 36.0667 },
        // { name: 'Anjar', lat: 33.7300, lon: 35.9300 },
        // { name: 'Aitanite', lat: 33.5667, lon: 35.8000 },
        // { name: 'Baalbek', lat: 34.0058, lon: 36.2181 },
        // { name: 'Barelias', lat: 33.8167, lon: 35.9833 },
        // { name: 'Beddawi', lat: 34.4500, lon: 36.0000 },
        // { name: 'Bekaa Valley', lat: 33.8333, lon: 35.9000 },
        // { name: 'Beriut', lat: 33.8933, lon: 35.5017 },
        // { name: 'Bire', lat: 33.8167, lon: 35.8667 },
        // { name: 'Brital', lat: 34.1333, lon: 36.2000 },
        // { name: 'Chlifa', lat: 33.5667, lon: 35.8333 },
        // { name: 'Chmistar', lat: 33.7167, lon: 35.7167 },
        // { name: 'Chtaura', lat: 33.8167, lon: 35.8500 },
        // { name: 'Deir el Ahmar', lat: 34.1167, lon: 36.1333 },
        // { name: 'Deir Zanoun', lat: 33.5500, lon: 35.5833 },
        // { name: 'Douris', lat: 33.7833, lon: 35.9833 },
        // { name: 'El Qaa', lat: 33.7500, lon: 36.0333 },
        // { name: 'Ferzol', lat: 33.7500, lon: 35.7167 },
        // { name: 'Haidab', lat: 33.6667, lon: 35.8333 },
        // { name: 'Halbet el Jazine', lat: 33.6333, lon: 35.8333 },
        // { name: 'Hammara', lat: 33.7167, lon: 35.9333 },
        // { name: 'Haret el Fikani', lat: 33.5667, lon: 35.7667 },
        // { name: 'Hazzerta', lat: 33.5667, lon: 35.7833 },
        // { name: 'Hoch el Omara', lat: 33.5833, lon: 35.8167 },
        // { name: 'Hoch Harime', lat: 33.6333, lon: 35.8667 },
        // { name: 'Hosh Barada', lat: 33.8167, lon: 36.0167 },
        // { name: 'Hosh el Rafika', lat: 33.8000, lon: 35.9833 },
        // { name: 'Jabboule', lat: 33.8167, lon: 36.0333 },
        // { name: 'Janta', lat: 33.9833, lon: 35.9833 },
        // { name: 'Jdita', lat: 33.8333, lon: 35.9000 },
        // { name: 'Joub Jannine', lat: 33.6275, lon: 35.7853 },
        // { name: 'Kaa el Rim', lat: 33.8667, lon: 35.9000 },
        // { name: 'Kafr Dan', lat: 33.5667, lon: 35.7667 },
        // { name: 'Kafr Zabad', lat: 33.7167, lon: 35.8667 },
        // { name: 'Karak', lat: 33.7333, lon: 35.8833 },
        // { name: 'Kfar Meshki', lat: 33.8667, lon: 35.8333 },
        // { name: 'Khraybe', lat: 33.6500, lon: 35.8500 },
        // { name: 'Kleyaate', lat: 33.7167, lon: 35.9167 },
        // { name: 'Laboué', lat: 33.8333, lon: 35.8667 },
        // { name: 'Machgara', lat: 33.5167, lon: 35.6500 },
        // { name: 'Majdal Anjar', lat: 33.7333, lon: 35.9167 },
        // { name: 'Mansoura', lat: 33.8833, lon: 35.8833 },
        // { name: 'Mariayoun', lat: 33.3667, lon: 35.5833 },
        // { name: 'Mashghara', lat: 33.5333, lon: 35.6667 },
        // { name: 'Mazraat Balde', lat: 33.6833, lon: 35.8500 },
        // { name: 'Mazraat el Chouf', lat: 33.7000, lon: 35.7167 },
        // { name: 'Mhaidse', lat: 33.5667, lon: 35.7667 },
        // { name: 'Nabi Ayla', lat: 33.5667, lon: 35.7833 },
        // { name: 'Nabi Chit', lat: 33.8667, lon: 35.9667 },
        // { name: 'Nabi Osmane', lat: 33.5667, lon: 35.7833 },
        // { name: 'Niha', lat: 33.6000, lon: 35.7333 },
        // { name: 'Qabb Ilyas', lat: 33.7000, lon: 35.8000 },
        // { name: 'Qab Elias', lat: 33.8000, lon: 35.8667 },
        // { name: 'Qalaat esh Shqif', lat: 33.3167, lon: 35.5167 },
        // { name: 'Qaraoun', lat: 33.5667, lon: 35.7167 },
        // { name: 'Qousaya', lat: 33.5667, lon: 35.7333 },
        // { name: 'Rayak', lat: 33.8500, lon: 36.0000 },
        // { name: 'Riyaq', lat: 33.8500, lon: 36.0000 },
        // { name: 'Saghbine', lat: 33.7000, lon: 35.7833 },
        // { name: 'Saïdé', lat: 33.5667, lon: 35.7667 },
        // { name: 'Saraain el Faouqa', lat: 33.8000, lon: 35.9333 },
        // { name: 'Saraain et Tahta', lat: 33.8000, lon: 35.9333 },
        // { name: 'Sohmor', lat: 33.5833, lon: 35.7833 },
        // { name: 'Sultan Yaacoub', lat: 33.8167, lon: 35.9000 },
        // { name: 'Taanayel', lat: 33.7333, lon: 35.7333 },
        // { name: 'Taanayil', lat: 33.7333, lon: 35.7333 },
        // { name: 'Talbiseh', lat: 34.3667, lon: 36.3667 },
        // { name: 'Tamnine', lat: 33.5167, lon: 35.5667 },
        // { name: 'Taalbaya', lat: 33.8500, lon: 35.9000 },
        // { name: 'Tefahne', lat: 33.4167, lon: 35.4833 },
        // { name: 'Terbol', lat: 33.8167, lon: 35.9833 },
        // { name: 'Toula', lat: 34.1167, lon: 36.1167 },
        // { name: 'Yammoune', lat: 34.1333, lon: 36.2333 },
        // { name: 'Yanta', lat: 33.9833, lon: 35.9833 },
        // { name: 'Zahle', lat: 33.8497, lon: 35.9042 },
        // { name: 'Zebdine', lat: 33.6333, lon: 35.8667 }
        // ],
        currentWeather: null,
        forecast: null,
        aiAdvisory: null,
        isDaytime: true,
        useFahrenheit: false,
        refreshing: false,
        errorMessage: '',
        map: null,
        markers: [],

        async init() {
            this.updateDate();
            this.initMap();
            // await this.loadAllLocationsWeather();
            await this.loadWeatherData();
            this.initSwiper();
            this.setupHourlyForecastToggle();
            this.updateDayNight();
        },

        updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        },

        // initMap() {
        //     this.map = L.map('map').setView([this.selectedLocation.lat, this.selectedLocation.lon], 10);
        //     L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        //         attribution: '&copy; OpenStreetMap contributors'
        //     }).addTo(this.map);

        //     this.locations.forEach(location => {
        //         const marker = L.marker([location.lat, location.lon]).addTo(this.map);
        //         marker.bindPopup(`<b>${location.name}</b><br>Loading weather...`);
        //         this.markers.push(marker);
        //     });
        // },

        initMap() {
    this.map = L.map('map').setView([this.selectedLocation.lat, this.selectedLocation.lon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(this.map);

    // Add markers but no weather fetch yet
    this.locations.forEach((location, index) => {
        const marker = L.marker([location.lat, location.lon]).addTo(this.map);
        marker.bindPopup(`<b>${location.name}</b><br><button onclick="window.weatherAppInstance.selectLocation(${index})">Load Weather</button>`);
        this.markers.push(marker);
    });
},


        async loadAllLocationsWeather() {
            for (let i = 0; i < this.locations.length; i++) {
                try {
                    const loc = this.locations[i];
                    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${loc.lat}&lon=${loc.lon}&appid=${this.apiKey}&units=metric`);
                    if (!res.ok) throw new Error('Weather fetch failed');
                    const data = await res.json();
                    data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                    data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                    loc.currentWeather = data;
                    this.markers[i].setPopupContent(`<b>${loc.name}</b><br>${Math.round(data.main.temp)}°C, ${data.weather[0].description}`);
                } catch(e) { console.error(e); }
            }
        },

        async loadWeatherData() {
            this.refreshing = true;
            this.errorMessage = '';
            try {
                // Current weather
                const resp = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!resp.ok) throw new Error('Current weather fetch failed');
                const data = await resp.json();
                data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                this.currentWeather = data;

                // Forecast
                const forecastResp = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!forecastResp.ok) throw new Error('Forecast fetch failed');
                const forecastData = await forecastResp.json();

                // Hourly (next 24h)
                this.forecast = {
                    hourly: forecastData.list.slice(0, 8).map(item => ({
                        dt: item.dt,
                        temp: Math.round(item.main.temp),
                        tempF: this.celsiusToFahrenheit(item.main.temp),
                        weather: item.weather
                    })),
                    daily: []
                };

                // Daily summary
                const days = {};
                forecastData.list.forEach(item => {
                    const date = new Date(item.dt * 1000).toLocaleDateString();
                    if (!days[date]) days[date] = [];
                    days[date].push(item);
                });
                for (const date in days) {
                    const items = days[date];
                    const temps = items.map(i => i.main.temp);
                    const tempMax = Math.max(...temps);
                    const tempMin = Math.min(...temps);
                    this.forecast.daily.push({
                        dt: items[0].dt,
                        temp: { max: Math.round(tempMax), min: Math.round(tempMin), maxF: this.celsiusToFahrenheit(tempMax), minF: this.celsiusToFahrenheit(tempMin) },
                        weather: items[0].weather
                    });
                }
                this.forecast.daily = this.forecast.daily.slice(0, 7);

                this.updateDayNightBasedOnTime(data.sys.sunrise, data.sys.sunset);
               
            } catch(e) {
                console.error(e);
                this.errorMessage = 'Failed to load weather data.';
            } finally {
                this.refreshing = false;
            }
        },

        celsiusToFahrenheit(c) { return Math.round(c * 9 / 5 + 32); },

        updateDayNight() {
            const h = new Date().getHours();
            this.isDaytime = h >= 6 && h < 18;
        },

        updateDayNightBasedOnTime(sunrise, sunset) {
            const now = Math.floor(Date.now() / 1000);
            this.isDaytime = now > sunrise && now < sunset;
        },

        getWeatherIcon(iconCode) {
            const map = {
                '01d': 'fas fa-sun','01n': 'fas fa-moon',
                '02d': 'fas fa-cloud-sun','02n': 'fas fa-cloud-moon',
                '03d': 'fas fa-cloud','03n': 'fas fa-cloud',
                '04d': 'fas fa-cloud','04n': 'fas fa-cloud',
                '09d': 'fas fa-cloud-showers-heavy','09n': 'fas fa-cloud-showers-heavy',
                '10d': 'fas fa-cloud-sun-rain','10n': 'fas fa-cloud-moon-rain',
                '11d': 'fas fa-bolt','11n': 'fas fa-bolt',
                '13d': 'fas fa-snowflake','13n': 'fas fa-snowflake',
                '50d': 'fas fa-smog','50n': 'fas fa-smog'
            };
            return map[iconCode] || 'fas fa-cloud';
        },

        getWeatherIconColor(iconCode) {
            if (iconCode.includes('01') || iconCode.includes('02')) return 'text-yellow-300';
            if (iconCode.includes('09') || iconCode.includes('10')) return 'text-blue-300';
            if (iconCode.includes('11')) return 'text-yellow-400';
            if (iconCode.includes('13')) return 'text-blue-100';
            return 'text-gray-300';
        },

        initSwiper() {
            new Swiper('.forecast-swiper', {
                slidesPerView: 2,
                spaceBetween: 15,
                pagination: { el: '.swiper-pagination', clickable: true },
                breakpoints: { 640:{slidesPerView:3},768:{slidesPerView:4},1024:{slidesPerView:5},1280:{slidesPerView:7} }
            });
        },

        setupHourlyForecastToggle() {
            document.getElementById('hourly-forecast-toggle').addEventListener('click', function(){
                const c = document.getElementById('hourly-forecast-content');
                const ch = document.getElementById('hourly-chevron');
                if (!c.style.maxHeight || c.style.maxHeight === '0px') { c.style.maxHeight='200px'; ch.style.transform='rotate(180deg)'; }
                else { c.style.maxHeight='0px'; ch.style.transform='rotate(0deg)'; }
            });
        },

        async selectLocation(locOrIndex) {
            const location = typeof locOrIndex === "number" ? this.locations[locOrIndex] : locOrIndex;
            this.selectedLocation = location;
            this.map.setView([location.lat, location.lon], 10);
            await this.loadWeatherData();
        },

        async refreshWeather() {
            await this.loadWeatherData();
            // await this.loadAllLocationsWeather();
            
        },

        getFarmingTip() {
            const tips = [
                'Consider planting drought-resistant crops during dry spells.',
                'Apply mulch to retain soil moisture during hot weather.',
                'Check irrigation systems for leaks and efficiency.',
                'Monitor crops for signs of heat stress during high temperatures.',
                'Plan planting schedules around expected rainfall patterns.',
                'Use row covers to protect young plants from unexpected cold snaps.'
            ];
            return tips[Math.floor(Math.random()*tips.length)];
        }
    };
}


document.addEventListener('DOMContentLoaded', () => {
    console.log('Weather app initialized.');
});

document.addEventListener('alpine:init', () => {
    Alpine.data('weatherApp', weatherApp);
    Alpine.effect(() => {
        if (Alpine.store('weatherApp')) {
            window.weatherAppInstance = Alpine.store('weatherApp');
        }
    });
});

</script> 

<!-- <script>
function weatherApp() {
    return {
        apiKey:"{{weather_api}}",
        defaultLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        selectedLocation: { name: 'Western Bekaa', lat: 33.6944, lon: 35.7928 },
        locations: [
            { name: "Aabd el Fattah", lat: 33.67, lon: 35.85 },
            { name: "Aaita el Foukhar", lat: 33.64, lon: 35.91 },
            { name: "Aaitanit", lat: 33.56, lon: 35.67 },
            { name: "Aali enn Nahri", lat: 33.86, lon: 36.03 },
            { name: "Aammîq", lat: 33.71, lon: 35.76 },
            { name: "Aanjar", lat: 33.73, lon: 35.93 },
            { name: "Aaramta", lat: 33.79, lon: 35.98 },
            { name: "Aaz el Arab", lat: 33.52, lon: 35.80 },
            { name: "Aaïha", lat: 33.50, lon: 35.88 },
            { name: "Ablah", lat: 33.87, lon: 35.97 },
            { name: "Ad Dakwah", lat: 33.69, lon: 35.88 },
            { name: "Ad Dalhamīyah", lat: 33.82, lon: 35.96 },
            { name: "Ain Aata", lat: 33.43, lon: 35.78 },
            { name: "Ain Ennakri", lat: 33.86, lon: 36.03 },
            { name: "Ain Horche", lat: 33.46, lon: 35.78 },
            { name: "Ain Zebde", lat: 33.62, lon: 35.70 },
            { name: "Ain el Ghmiqa", lat: 33.83, lon: 35.82 },
            { name: "Ain et Tine", lat: 33.50, lon: 35.64 },
            { name: "Akbe", lat: 33.51, lon: 35.82 },
            { name: "Al Akramiyah", lat: 33.72, lon: 35.92 },
            { name: "Al Bayyadah", lat: 33.50, lon: 35.65 },
            { name: "Al Bayāḑah", lat: 33.82, lon: 35.84 },
            { name: "Al Bīrah", lat: 33.58, lon: 35.82 },
            { name: "Al Fa`ur", lat: 33.78, lon: 35.97 },
            { name: "Al Furzul", lat: 33.88, lon: 35.95 },
            { name: "Al Ghābah", lat: 33.85, lon: 35.97 },
            { name: "Al Hammar", lat: 33.87, lon: 35.90 },
            { name: "Al Hara'iq", lat: 33.82, lon: 36.00 },
            { name: "Al Hilwah", lat: 33.61, lon: 36.00 },
            { name: "Al Istabil", lat: 33.75, lon: 35.88 },
            { name: "Al Jawzah", lat: 33.85, lon: 35.82 },
            { name: "Al Jazirah", lat: 33.72, lon: 35.85 },
            { name: "Al Khiyārah", lat: 33.69, lon: 35.85 },
            { name: "Al Mallāḩah", lat: 33.83, lon: 35.83 },
            { name: "Al Manşūrah", lat: 33.68, lon: 35.81 },
            { name: "Al Marj", lat: 33.76, lon: 35.88 },
            { name: "Al Mu`allaqah", lat: 33.84, lon: 35.92 },
            { name: "Al Muhaytah", lat: 33.56, lon: 35.81 },
            { name: "Al Murayjāt", lat: 33.81, lon: 35.82 },
            { name: "Al Muzayyanah", lat: 33.79, lon: 35.82 },
            { name: "Al Mīdān", lat: 33.85, lon: 35.91 },
            { name: "Al Qan`abah", lat: 33.48, lon: 35.77 },
            { name: "Al Qar‘awn", lat: 33.56, lon: 35.72 },
            { name: "Al Qati`", lat: 33.85, lon: 35.86 },
            { name: "Al Qaşr", lat: 33.72, lon: 35.76 },
            { name: "Al Wādī", lat: 33.84, lon: 35.86 },
            { name: "Al `Ammuri", lat: 33.81, lon: 35.87 },
            { name: "Al Ḩawsh", lat: 33.48, lon: 35.75 },
            { name: "Al Ḩārah", lat: 33.85, lon: 35.86 },
            { name: "Ali en Nahri", lat: 33.86, lon: 36.03 },
            { name: "Amnik", lat: 33.71, lon: 35.76 },
            { name: "An Na`sat", lat: 33.81, lon: 35.84 },
            { name: "An Nab`at", lat: 33.49, lon: 35.75 },
            { name: "An Nabī Aylā", lat: 33.88, lon: 35.96 },
            { name: "An Naqbah", lat: 33.81, lon: 35.84 },
            { name: "An Nasiriyah", lat: 33.86, lon: 36.06 },
            { name: "Andžaras", lat: 33.73, lon: 35.93 },
            { name: "Ar Rafid", lat: 33.57, lon: 35.82 },
            { name: "Ar Ramtaniyah", lat: 33.84, lon: 35.82 },
            { name: "Ar Rumayl", lat: 33.65, lon: 35.79 },
            { name: "Aradi el Aaqabe", lat: 33.62, lon: 35.73 },
            { name: "Ard", lat: 33.82, lon: 35.86 },
            { name: "As Safrah", lat: 33.75, lon: 35.80 },
            { name: "As Sawirah", lat: 33.69, lon: 35.91 },
            { name: "As Sultan Ya`qub", lat: 33.64, lon: 35.86 },
            { name: "As Surayj", lat: 33.80, lon: 35.82 },
            { name: "Ash Shabraqīyah", lat: 33.78, lon: 35.87 },
            { name: "At Tuwaytah", lat: 33.86, lon: 35.85 },
            { name: "Az Zarub", lat: 33.58, lon: 35.81 },
            { name: "Az Zu‘rūrah", lat: 33.81, lon: 35.87 },
            { name: "Aâna", lat: 33.69, lon: 35.75 },
            { name: "Aïn Aarab", lat: 33.58, lon: 35.87 },
            { name: "Aïn Herché", lat: 33.46, lon: 35.78 },
            { name: "Aïn Kafer Zabad", lat: 33.79, lon: 35.99 },
            { name: "Aïn Kfar Zabad", lat: 33.80, lon: 36.01 },
            { name: "Aïn el Laboué", lat: 33.52, lon: 35.82 },
            { name: "Aïtanît", lat: 33.56, lon: 35.67 },
            { name: "Baaloul", lat: 33.59, lon: 35.75, elev_ft: 4340, pop_est: 0 },
            { name: "Bab Mare", lat: 33.58, lon: 35.68, elev_ft: 2732, pop_est: 7979 },
            { name: "Bakka", lat: 33.59, lon: 35.92, elev_ft: 5029, pop_est: 61 },
            { name: "Bakkeefa", lat: 33.49, lon: 35.82, elev_ft: 3349, pop_est: 18841 },
            { name: "Bar Elias", lat: 33.77, lon: 35.90, elev_ft: 2887, pop_est: 94659 },
            { name: "Barbara", lat: 33.85, lon: 35.90, elev_ft: 3349, pop_est: 40994 },
            { name: "Bouarej", lat: 33.82, lon: 35.82, elev_ft: 3402, pop_est: 28367 },
            { name: "Bayt Lahiyah", lat: 33.48, lon: 35.80, elev_ft: 3349, pop_est: 10865 },
            { name: "Behinna", lat: 33.91, lon: 35.88, elev_ft: 5029, pop_est: 32247 },
            { name: "Beit Zakhour", lat: 33.82, lon: 35.87, elev_ft: 3349, pop_est: 55083 },
            { name: "Beït Zakhoûr", lat: 33.83, lon: 35.87, elev_ft: 3349, pop_est: 44786 },
            { name: "Bou Frès", lat: 33.55, lon: 35.70, elev_ft: 2795, pop_est: 174 },
            { name: "Bou Zaher", lat: 33.64, lon: 35.72, elev_ft: 3349, pop_est: 3729 },
            { name: "Bsouje", lat: 33.91, lon: 35.87, elev_ft: 5029, pop_est: 40814 },
            { name: "Chebrqiyé", lat: 33.78, lon: 35.87, elev_ft: 2883, pop_est: 91225 },
  { name: "Chtaura", lat: 33.82, lon: 35.85, elev_ft: 3349, pop_est: 44013 },
   { name: "Dahr as Sawwan", lat: 33.81, lon: 35.85, elev_ft: 3349, pop_est: 44143 },
  { name: "Dahr el Ahmar", lat: 33.53, lon: 35.84, elev_ft: 4189, pop_est: 23971 },
  { name: "Dahr el Blait", lat: 33.83, lon: 35.85, elev_ft: 3372, pop_est: 40021 },
  { name: "Dalhamiyah", lat: 33.82, lon: 35.96, elev_ft: 2923, pop_est: 34451 },
  { name: "Dallafah", lat: 33.43, lon: 35.65, elev_ft: 2509, pop_est: 3762 },
  { name: "Darzanoun", lat: 33.75, lon: 35.92, elev_ft: 2874, pop_est: 93186 },
  { name: "Deir Tahnish", lat: 33.70, lon: 35.76, elev_ft: 2874, pop_est: 5639 },
  { name: "Deir Ayn al Jawzah", lat: 33.60, lon: 35.69, elev_ft: 2732, pop_est: 7154 },
  { name: "Deir al Ghazal", lat: 33.82, lon: 36.03, elev_ft: 3464, pop_est: 29095 },
  { name: "Deir al Achaair", lat: 33.56, lon: 36.01, elev_ft: 4189, pop_est: 2232 },
  { name: "Deir Zenoun", lat: 33.75, lon: 35.92, elev_ft: 2874, pop_est: 93186 },
  { name: "Djeb Djennin", lat: 33.63, lon: 35.78, elev_ft: 3349, pop_est: 0 },
  { name: "Djedita", lat: 33.82, lon: 35.84, elev_ft: 3375, pop_est: 34994 },
  { name: "Djezirah", lat: 33.72, lon: 35.85, elev_ft: 2883, pop_est: 57975 },
 { name: "Ed Dakoué", lat: 33.69, lon: 35.88 },
  { name: "Ed Dalhamîyé", lat: 33.82, lon: 35.96 },
  { name: "Ej Jaouzé", lat: 33.85, lon: 35.82 },
  { name: "Ej Jezire", lat: 33.72, lon: 35.85 },
  { name: "El Aammoûri", lat: 33.81, lon: 35.87 },
  { name: "El Aaouja", lat: 33.53, lon: 35.66 },
  { name: "El Aaqabe", lat: 33.51, lon: 35.82 },
  { name: "El Akramîyé", lat: 33.72, lon: 35.92 },
  { name: "El Baiyada", lat: 33.50, lon: 35.65 },
  { name: "El Bayad", lat: 33.82, lon: 36.01 },
  { name: "El Baïyâra", lat: 33.43, lon: 35.65 },
  { name: "El Biyâda", lat: 33.82, lon: 35.84 },
  { name: "El Bîré", lat: 33.58, lon: 35.82 },
  { name: "El Establ", lat: 33.75, lon: 35.88 },
  { name: "El Faqaa", lat: 33.46, lon: 35.82 },
  { name: "El Fourzol", lat: 33.88, lon: 35.95 },
  { name: "El Fâaoûr", lat: 33.78, lon: 35.97 },
  { name: "El Ghabe", lat: 33.85, lon: 35.97 },
  { name: "El Ghaberi", lat: 33.54, lon: 35.68 },
  { name: "El Hammari", lat: 33.58, lon: 35.72 },
  { name: "El Haouch", lat: 33.48, lon: 35.75 },
  { name: "El Hara", lat: 33.85, lon: 35.86 },
  { name: "El Harqât", lat: 33.86, lon: 35.91 },
  { name: "El Harâyeq", lat: 33.82, lon: 36.00 },
  { name: "El Heloue", lat: 33.61, lon: 36.00 },
  { name: "El Hemmar", lat: 33.87, lon: 35.90 },
  { name: "El Houssiâne", lat: 33.58, lon: 35.70 },
  { name: "El Karak", lat: 33.85, lon: 35.93 },
  { name: "El Khiâra", lat: 33.69, lon: 35.85 },
  { name: "El M`allaqah", lat: 33.84, lon: 35.92 },
  { name: "El Mannsoura", lat: 33.68, lon: 35.81 },
  { name: "El Marj", lat: 33.76, lon: 35.88 },
  { name: "El Mazraat", lat: 33.47, lon: 35.77 },
  { name: "El Mhatta", lat: 33.83, lon: 35.83 },
  { name: "El Mhaïdthé", lat: 33.56, lon: 35.81 },
  { name: "El Midane", lat: 33.85, lon: 35.91 },
  { name: "El Mraïjât", lat: 33.81, lon: 35.82 },
  { name: "El Mzaiyani", lat: 33.79, lon: 35.82 },
  { name: "El Obaïr", lat: 33.58, lon: 35.70 },
  { name: "El Ouaar", lat: 33.47, lon: 35.64 },
  { name: "El Ouatié", lat: 33.50, lon: 35.65 },
  { name: "El Ouâdi", lat: 33.84, lon: 35.86 },
  { name: "El Qar‘aun", lat: 33.56, lon: 35.72 },
  { name: "El Qasr", lat: 33.72, lon: 35.76 },
  { name: "El Qasr (South)", lat: 33.64, lon: 35.71 },
  { name: "El Qennah`bah", lat: 33.48, lon: 35.77 },
  { name: "El Qilya", lat: 33.44, lon: 35.66 },
  { name: "El Qinnaabé", lat: 33.48, lon: 35.77 },
  { name: "El Qâtiaa", lat: 33.85, lon: 35.86 },
  { name: "El-Jazeerah", lat: 33.72, lon: 35.85 },
  { name: "En Naassat", lat: 33.81, lon: 35.84 },
  { name: "En Nabaat", lat: 33.49, lon: 35.75 },
  { name: "En Nabi Ayla", lat: 33.88, lon: 35.96 },
  { name: "En Naqbé", lat: 33.81, lon: 35.84 },
  { name: "En Nasriyah", lat: 33.86, lon: 36.06 },
  { name: "En Nâhrîyé", lat: 33.78, lon: 35.84 },
  { name: "Er Rafîd", lat: 33.57, lon: 35.82 },
  { name: "Er Ramtânîyé", lat: 33.84, lon: 35.82 },
  { name: "Er Rmaïl", lat: 33.65, lon: 35.79 },
  { name: "Es Safra", lat: 33.75, lon: 35.80 },
  { name: "Es Saouire", lat: 33.69, lon: 35.91 },
  { name: "Es Soultane Yaaqoub", lat: 33.64, lon: 35.86 },
  { name: "Es Sraïj", lat: 33.80, lon: 35.82 },
  { name: "Es-Samah", lat: 33.50, lon: 35.80 },
  { name: "Es-Sultan Ya`qoub el-Fauqa", lat: 33.64, lon: 35.86 },
  { name: "Es-Sultan Ya`qoub et-Tahta", lat: 33.64, lon: 35.84 },
  { name: "Et-Tweitah", lat: 33.86, lon: 35.85 },
  { name: "Ez Zaaroûra", lat: 33.81, lon: 35.87 },
  { name: "Ez Zâroûb", lat: 33.58, lon: 35.81 },
         { name: "Faouq el Bîr", lat: 33.67, lon: 35.83 },
  { name: "Foht Hima Hassan", lat: 33.46, lon: 35.83 },
  { name: "Fourzol", lat: 33.88, lon: 35.95 },
  { name: "Ghazzah", lat: 33.67, lon: 35.83 },
   { name: "Hai el-Fikani", lat: 33.85, lon: 36.03 },
  { name: "Haloua", lat: 33.61, lon: 36.00 },
  { name: "Hammarah", lat: 33.65, lon: 35.89 },
  { name: "Hamoui", lat: 33.85, lon: 35.86 },
  { name: "Hansh Mousa", lat: 33.73, lon: 35.93 },
  { name: "Haouch", lat: 33.48, lon: 35.75 },
  { name: "Haouch Aammik", lat: 33.72, lon: 35.78 },
  { name: "Haouch Hala", lat: 33.85, lon: 35.99 },
  { name: "Haouch Mandara", lat: 33.78, lon: 35.86 },
  { name: "Haouch Moch", lat: 33.82, lon: 36.02 },
  { name: "Haouch Qaïssar", lat: 33.77, lon: 35.81 },
  { name: "Haouch Rhanem", lat: 33.87, lon: 36.03 },
  { name: "Haouch el Harime", lat: 33.72, lon: 35.86 },
  { name: "Haouch el Omara", lat: 33.84, lon: 35.90 },
  { name: "Haouch es Siyâdi", lat: 33.77, lon: 35.83 },
  { name: "Haouch ez Zaraane", lat: 33.85, lon: 35.91 },
  { name: "Haoush Mousa", lat: 33.73, lon: 35.93 },
  { name: "Haql Hammana", lat: 33.87, lon: 35.84 },
  { name: "Haql al `Ayn", lat: 33.82, lon: 35.87 },
  { name: "Harat al Fawqa", lat: 33.83, lon: 35.83 },
  { name: "Haret el Faouqa", lat: 33.82, lon: 35.82 },
  { name: "Haret el Fikâni", lat: 33.85, lon: 36.03 },
  { name: "Haret el Kaouasbé", lat: 33.50, lon: 35.84 },
  { name: "Haret et Tahta", lat: 33.82, lon: 35.81 },
  { name: "Haush Hala", lat: 33.85, lon: 35.99 },
  { name: "Haush `Ammeeq", lat: 33.72, lon: 35.78 },
  { name: "Haush el-Ghanam", lat: 33.87, lon: 36.03 },
  { name: "Haush el-Umara", lat: 33.84, lon: 35.90 },
  { name: "Hawsh Hala", lat: 33.85, lon: 35.99 },
  { name: "Hawsh Qaysar", lat: 33.77, lon: 35.81 },
  { name: "Hawsh `Ammiq", lat: 33.72, lon: 35.78 },
  { name: "Hawsh ad Dibs", lat: 33.76, lon: 35.81 },
  { name: "Hawsh adh Dhunaybah", lat: 33.48, lon: 35.75 },
  { name: "Hawsh al Mandarah", lat: 33.78, lon: 35.86 },
  { name: "Hawsh al Umara'", lat: 33.84, lon: 35.90 },
  { name: "Hawsh as Sayyadah", lat: 33.77, lon: 35.83 },
  { name: "Hawsh az Zara`inah", lat: 33.85, lon: 35.91 },
  { name: "Hayy Ja`ir", lat: 33.80, lon: 35.82 },
  { name: "Hayy al Ba`l", lat: 33.82, lon: 35.87 },
  { name: "Hayy al Jami`", lat: 33.82, lon: 35.87 },
  { name: "Hazerta", lat: 33.88, lon: 35.87 },
  { name: "Haï Jaaïr", lat: 33.80, lon: 35.82 },
  { name: "Haï Mâr Eliâs", lat: 33.82, lon: 35.87 },
  { name: "Haï ed Dhaïni", lat: 33.82, lon: 35.87 },
  { name: "Haï ej Jâmia", lat: 33.82, lon: 35.87 },
  { name: "Haï el Baal", lat: 33.82, lon: 35.87 },
  { name: "Hbâq el Hebâs", lat: 33.61, lon: 35.73 },
  { name: "Hishmush", lat: 33.82, lon: 36.02 },
  { name: "Hizzirta", lat: 33.88, lon: 35.87 },
  { name: "Hoch Moch", lat: 33.82, lon: 36.02 },
  { name: "Hosaya", lat: 33.81, lon: 36.02 },
  { name: "Hoshmosh", lat: 33.82, lon: 36.02 },
  { name: "Hushmush", lat: 33.82, lon: 36.02 },
   { name: "Istabl", lat: 33.75, lon: 35.88 },
   { name: "Jaafar", lat: 33.47, lon: 35.77 },
  { name: "Jadita", lat: 33.82, lon: 35.84 },
  { name: "Jalâla", lat: 33.82, lon: 35.86 },
  { name: "Jebb Farah", lat: 33.52, lon: 35.79 },
  { name: "Joub Jannine", lat: 33.63, lon: 35.78 },
  { name: "Judaydat Yabus", lat: 33.67, lon: 35.93 },
   { name: "KFARZABAD", lat: 33.79, lon: 35.99 },
  { name: "Kafr Danīs", lat: 33.55, lon: 35.85 },
  { name: "Kafr Mishki", lat: 33.52, lon: 35.77 },
  { name: "Kafr Qūq", lat: 33.53, lon: 35.89 },
  { name: "Kamed Al Lawz", lat: 33.62, lon: 35.82 },
  { name: "Karak Nuh", lat: 33.85, lon: 35.93 },
  { name: "Kawkaba Bu `Arab", lat: 33.53, lon: 35.78 },
  { name: "Kefraïya", lat: 33.67, lon: 35.73 },
  { name: "Khallet Im Sleimane", lat: 33.83, lon: 35.85 },
  { name: "Khirbat Qanāfār", lat: 33.64, lon: 35.72 },
  { name: "Khirbat Rūḩā", lat: 33.57, lon: 35.85 },
  { name: "Khommaret Jraissati", lat: 33.83, lon: 35.87 },
  { name: "Kouaa el Armane", lat: 33.51, lon: 35.84 },
  { name: "Kroûm ed Daïaa", lat: 33.80, lon: 35.83 },
  { name: "Ksar al Hanash", lat: 33.75, lon: 35.88 },
   { name: "Lebbaya", lat: 33.48, lon: 35.72 },
  { name: "Loûssi", lat: 33.65, lon: 35.84 },
  { name: "Lâla", lat: 33.60, lon: 35.76 },
   { name: "Ma`zar", lat: 33.58, lon: 35.97 },
  { name: "Maallaqa", lat: 33.84, lon: 35.92 },
  { name: "Machghara", lat: 33.53, lon: 35.65 },
  { name: "Maidoun", lat: 33.47, lon: 35.64 },
  { name: "Majdal `Anjar", lat: 33.71, lon: 35.90 },
  { name: "Maksah", lat: 33.81, lon: 35.83 },
  { name: "Mansoûra", lat: 33.68, lon: 35.81 },
  { name: "Mar Ilyas", lat: 33.84, lon: 35.89 },
  { name: "Marj Aali", lat: 33.86, lon: 35.96 },
  { name: "Marj as Samāḩ", lat: 33.50, lon: 35.80 },
  { name: "Mazra`at Dayr al `Asha'ir", lat: 33.58, lon: 36.01 },
  { name: "Mazra`at Ja`far", lat: 33.47, lon: 35.77 },
  { name: "Mazra`at `Ayn Qaniyah", lat: 33.62, lon: 35.90 },
  { name: "Mazra`at `Azzah", lat: 33.61, lon: 35.84 },
  { name: "Mazra`at al Qalyun", lat: 33.61, lon: 35.91 },
  { name: "Mazra`at ash Shumayyisah", lat: 33.52, lon: 35.73 },
  { name: "Mazraat", lat: 33.48, lon: 35.86 },
  { name: "Mdoûkha", lat: 33.61, lon: 35.88 },
  { name: "Morh el Ouaarât", lat: 33.60, lon: 36.02 },
  { name: "Mraymis", lat: 33.47, lon: 35.76 },
  { name: "Mrâh ej Jammâl", lat: 33.58, lon: 35.95 },
  { name: "Mâssa", lat: 33.85, lon: 36.07 },
  { name: "Nab` al `Asal", lat: 33.83, lon: 35.82 },
  { name: "Nabat", lat: 33.49, lon: 35.75 },
  { name: "Nabi Ayla", lat: 33.88, lon: 35.96 },
  { name: "Nasriye", lat: 33.86, lon: 36.06 },
  { name: "Niha", lat: 33.89, lon: 35.97 },
   { name: "Ouadaï ed Dâher", lat: 33.80, lon: 35.80 },
  { name: "Ouadi el Aarayech", lat: 33.86, lon: 35.90 },
  { name: "Ouataya Bou Hamze", lat: 33.82, lon: 35.82 },
  { name: "Qa`ar Rim", lat: 33.88, lon: 35.88 },
  { name: "Qabb Elias", lat: 33.80, lon: 35.82 },
  { name: "Qamar ed Dine", lat: 33.86, lon: 35.90 },
  { name: "Qana`bah", lat: 33.48, lon: 35.77 },
  { name: "Qaraaoun", lat: 33.56, lon: 35.72 },
  { name: "Qasr", lat: 33.64, lon: 35.71 },
  { name: "Qelia", lat: 33.44, lon: 35.66 },
  { name: "Qommol", lat: 33.84, lon: 35.86 },
  { name: "Qoussaya", lat: 33.81, lon: 36.02 },
   { name: "R`it", lat: 33.83, lon: 36.04 },
  { name: "Ra'siyah", lat: 33.85, lon: 35.89 },
  { name: "Rachaiya", lat: 33.50, lon: 35.84 },
  { name: "Rayak", lat: 33.85, lon: 36.00 },
   { name: "Sehmour", lat: 33.52, lon: 35.69 },
  { name: "Soultan Yaakoub", lat: 33.64, lon: 35.86 },
  { name: "Saad Nayil", lat: 33.82, lon: 35.88 },
  { name: "Saghbin", lat: 33.61, lon: 35.70 },
  { name: "Sahm at Tawbah", lat: 33.86, lon: 36.02 },
  { name: "Sahm ej Jaras", lat: 33.66, lon: 35.75 },
  { name: "Sahrat al Qashsh", lat: 33.79, lon: 35.82 },
  { name: "Saouiri", lat: 33.69, lon: 35.91 },
  { name: "Shtawrah", lat: 33.82, lon: 35.85 },
  { name: "Talabaya", lat: 33.81, lon: 35.86 },
  { name: "Tanayil", lat: 33.80, lon: 35.87 },
  { name: "Tall Dhnub", lat: 33.66, lon: 35.78 },
  { name: "Tall Dhnub al Jadidah", lat: 33.67, lon: 35.77 },
  { name: "Tall al Akhdar", lat: 33.73, lon: 35.83 },
  { name: "Tall az Zaazi", lat: 33.67, lon: 35.85 },
  { name: "Tallat al Jammas", lat: 33.74, lon: 35.92 },
  { name: "Tannoura", lat: 33.47, lon: 35.80 },
  { name: "Tariq ej Jdide", lat: 33.80, lon: 35.83 },
  { name: "Tell Kamid el-Loz", lat: 33.62, lon: 35.82 },
  { name: "Tell Znoub", lat: 33.66, lon: 35.78 },
  { name: "Tell Znoûb ej Jdide", lat: 33.67, lon: 35.77 },
  { name: "Tell el Akhdar", lat: 33.73, lon: 35.83 },
  { name: "Tell ez Zaazeaa", lat: 33.67, lon: 35.85 },
  { name: "Tellet ej Jemmas", lat: 33.74, lon: 35.92 },
  { name: "Terbol", lat: 33.82, lon: 35.98 },
  { name: "Thulthata", lat: 33.50, lon: 35.75 },
  { name: "Timray", lat: 33.52, lon: 35.66 },
  { name: "Touaite", lat: 33.86, lon: 35.85 },
  { name: "Toultata", lat: 33.50, lon: 35.75 },
  { name: "Turbul", lat: 33.82, lon: 35.98 },
   { name: "Wadi ad Dahr", lat: 33.80, lon: 35.80 },
  { name: "Wadi ad Dalam", lat: 33.80, lon: 35.80 },
  { name: "Wadi al Ara'ish", lat: 33.86, lon: 35.90 },
  { name: "Wataya Bu Hamzah", lat: 33.82, lon: 35.82 },
  { name: "Yanta", lat: 33.60, lon: 35.94 },
  { name: "Yohmor el Beqaa", lat: 33.49, lon: 35.67 },
  { name: "Zahle", lat: 33.85, lon: 35.90 },
  { name: "Zebdol", lat: 33.82, lon: 35.84 },
  { name: "Zellaya", lat: 33.46, lon: 35.67 }
        ],
        // locations: [
        //     { name: 'Ain Zebde', lat: 33.6333, lon: 35.8667 },
        // { name: 'Al Ain', lat: 33.7333, lon: 35.8833 },
        // { name: 'Amik', lat: 33.9833, lon: 36.0667 },
        // { name: 'Anjar', lat: 33.7300, lon: 35.9300 },
        // { name: 'Aitanite', lat: 33.5667, lon: 35.8000 },
        // { name: 'Baalbek', lat: 34.0058, lon: 36.2181 },
        // { name: 'Barelias', lat: 33.8167, lon: 35.9833 },
        // { name: 'Beddawi', lat: 34.4500, lon: 36.0000 },
        // { name: 'Bekaa Valley', lat: 33.8333, lon: 35.9000 },
        // { name: 'Beriut', lat: 33.8933, lon: 35.5017 },
        // { name: 'Bire', lat: 33.8167, lon: 35.8667 },
        // { name: 'Brital', lat: 34.1333, lon: 36.2000 },
        // { name: 'Chlifa', lat: 33.5667, lon: 35.8333 },
        // { name: 'Chmistar', lat: 33.7167, lon: 35.7167 },
        // { name: 'Chtaura', lat: 33.8167, lon: 35.8500 },
        // { name: 'Deir el Ahmar', lat: 34.1167, lon: 36.1333 },
        // { name: 'Deir Zanoun', lat: 33.5500, lon: 35.5833 },
        // { name: 'Douris', lat: 33.7833, lon: 35.9833 },
        // { name: 'El Qaa', lat: 33.7500, lon: 36.0333 },
        // { name: 'Ferzol', lat: 33.7500, lon: 35.7167 },
        // { name: 'Haidab', lat: 33.6667, lon: 35.8333 },
        // { name: 'Halbet el Jazine', lat: 33.6333, lon: 35.8333 },
        // { name: 'Hammara', lat: 33.7167, lon: 35.9333 },
        // { name: 'Haret el Fikani', lat: 33.5667, lon: 35.7667 },
        // { name: 'Hazzerta', lat: 33.5667, lon: 35.7833 },
        // { name: 'Hoch el Omara', lat: 33.5833, lon: 35.8167 },
        // { name: 'Hoch Harime', lat: 33.6333, lon: 35.8667 },
        // { name: 'Hosh Barada', lat: 33.8167, lon: 36.0167 },
        // { name: 'Hosh el Rafika', lat: 33.8000, lon: 35.9833 },
        // { name: 'Jabboule', lat: 33.8167, lon: 36.0333 },
        // { name: 'Janta', lat: 33.9833, lon: 35.9833 },
        // { name: 'Jdita', lat: 33.8333, lon: 35.9000 },
        // { name: 'Joub Jannine', lat: 33.6275, lon: 35.7853 },
        // { name: 'Kaa el Rim', lat: 33.8667, lon: 35.9000 },
        // { name: 'Kafr Dan', lat: 33.5667, lon: 35.7667 },
        // { name: 'Kafr Zabad', lat: 33.7167, lon: 35.8667 },
        // { name: 'Karak', lat: 33.7333, lon: 35.8833 },
        // { name: 'Kfar Meshki', lat: 33.8667, lon: 35.8333 },
        // { name: 'Khraybe', lat: 33.6500, lon: 35.8500 },
        // { name: 'Kleyaate', lat: 33.7167, lon: 35.9167 },
        // { name: 'Laboué', lat: 33.8333, lon: 35.8667 },
        // { name: 'Machgara', lat: 33.5167, lon: 35.6500 },
        // { name: 'Majdal Anjar', lat: 33.7333, lon: 35.9167 },
        // { name: 'Mansoura', lat: 33.8833, lon: 35.8833 },
        // { name: 'Mariayoun', lat: 33.3667, lon: 35.5833 },
        // { name: 'Mashghara', lat: 33.5333, lon: 35.6667 },
        // { name: 'Mazraat Balde', lat: 33.6833, lon: 35.8500 },
        // { name: 'Mazraat el Chouf', lat: 33.7000, lon: 35.7167 },
        // { name: 'Mhaidse', lat: 33.5667, lon: 35.7667 },
        // { name: 'Nabi Ayla', lat: 33.5667, lon: 35.7833 },
        // { name: 'Nabi Chit', lat: 33.8667, lon: 35.9667 },
        // { name: 'Nabi Osmane', lat: 33.5667, lon: 35.7833 },
        // { name: 'Niha', lat: 33.6000, lon: 35.7333 },
        // { name: 'Qabb Ilyas', lat: 33.7000, lon: 35.8000 },
        // { name: 'Qab Elias', lat: 33.8000, lon: 35.8667 },
        // { name: 'Qalaat esh Shqif', lat: 33.3167, lon: 35.5167 },
        // { name: 'Qaraoun', lat: 33.5667, lon: 35.7167 },
        // { name: 'Qousaya', lat: 33.5667, lon: 35.7333 },
        // { name: 'Rayak', lat: 33.8500, lon: 36.0000 },
        // { name: 'Riyaq', lat: 33.8500, lon: 36.0000 },
        // { name: 'Saghbine', lat: 33.7000, lon: 35.7833 },
        // { name: 'Saïdé', lat: 33.5667, lon: 35.7667 },
        // { name: 'Saraain el Faouqa', lat: 33.8000, lon: 35.9333 },
        // { name: 'Saraain et Tahta', lat: 33.8000, lon: 35.9333 },
        // { name: 'Sohmor', lat: 33.5833, lon: 35.7833 },
        // { name: 'Sultan Yaacoub', lat: 33.8167, lon: 35.9000 },
        // { name: 'Taanayel', lat: 33.7333, lon: 35.7333 },
        // { name: 'Taanayil', lat: 33.7333, lon: 35.7333 },
        // { name: 'Talbiseh', lat: 34.3667, lon: 36.3667 },
        // { name: 'Tamnine', lat: 33.5167, lon: 35.5667 },
        // { name: 'Taalbaya', lat: 33.8500, lon: 35.9000 },
        // { name: 'Tefahne', lat: 33.4167, lon: 35.4833 },
        // { name: 'Terbol', lat: 33.8167, lon: 35.9833 },
        // { name: 'Toula', lat: 34.1167, lon: 36.1167 },
        // { name: 'Yammoune', lat: 34.1333, lon: 36.2333 },
        // { name: 'Yanta', lat: 33.9833, lon: 35.9833 },
        // { name: 'Zahle', lat: 33.8497, lon: 35.9042 },
        // { name: 'Zebdine', lat: 33.6333, lon: 35.8667 }
        // ],
        currentWeather: null,
        forecast: null,
        aiAdvisory: null,
        isDaytime: true,
        useFahrenheit: false,
        refreshing: false,
        errorMessage: '',
        map: null,
        markers: [],

        async init() {
            this.updateDate();
            this.initMap();
            await this.loadAllLocationsWeather();
            await this.loadWeatherData();
            this.initSwiper();
            this.setupHourlyForecastToggle();
            this.updateDayNight();
        },

        updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        },

        initMap() {
            this.map = L.map('map').setView([this.selectedLocation.lat, this.selectedLocation.lon], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(this.map);

            this.locations.forEach(location => {
                const marker = L.marker([location.lat, location.lon]).addTo(this.map);
                marker.bindPopup(`<b>${location.name}</b><br>Loading weather...`);
                this.markers.push(marker);
            });
        },

        async loadAllLocationsWeather() {
            for (let i = 0; i < this.locations.length; i++) {
                try {
                    const loc = this.locations[i];
                    const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${loc.lat}&lon=${loc.lon}&appid=${this.apiKey}&units=metric`);
                    if (!res.ok) throw new Error('Weather fetch failed');
                    const data = await res.json();
                    data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                    data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                    loc.currentWeather = data;
                    this.markers[i].setPopupContent(`<b>${loc.name}</b><br>${Math.round(data.main.temp)}°C, ${data.weather[0].description}`);
                } catch(e) { console.error(e); }
            }
        },

        async loadWeatherData() {
            this.refreshing = true;
            this.errorMessage = '';
            try {
                // Current weather
                const resp = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!resp.ok) throw new Error('Current weather fetch failed');
                const data = await resp.json();
                data.main.tempF = this.celsiusToFahrenheit(data.main.temp);
                data.main.feels_likeF = this.celsiusToFahrenheit(data.main.feels_like);
                this.currentWeather = data;

                // Forecast
                const forecastResp = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${this.selectedLocation.lat}&lon=${this.selectedLocation.lon}&appid=${this.apiKey}&units=metric`);
                if (!forecastResp.ok) throw new Error('Forecast fetch failed');
                const forecastData = await forecastResp.json();

                // Hourly (next 24h)
                this.forecast = {
                    hourly: forecastData.list.slice(0, 8).map(item => ({
                        dt: item.dt,
                        temp: Math.round(item.main.temp),
                        tempF: this.celsiusToFahrenheit(item.main.temp),
                        weather: item.weather
                    })),
                    daily: []
                };

                // Daily summary
                const days = {};
                forecastData.list.forEach(item => {
                    const date = new Date(item.dt * 1000).toLocaleDateString();
                    if (!days[date]) days[date] = [];
                    days[date].push(item);
                });
                for (const date in days) {
                    const items = days[date];
                    const temps = items.map(i => i.main.temp);
                    const tempMax = Math.max(...temps);
                    const tempMin = Math.min(...temps);
                    this.forecast.daily.push({
                        dt: items[0].dt,
                        temp: { max: Math.round(tempMax), min: Math.round(tempMin), maxF: this.celsiusToFahrenheit(tempMax), minF: this.celsiusToFahrenheit(tempMin) },
                        weather: items[0].weather
                    });
                }
                this.forecast.daily = this.forecast.daily.slice(0, 7);

                this.updateDayNightBasedOnTime(data.sys.sunrise, data.sys.sunset);
               
            } catch(e) {
                console.error(e);
                this.errorMessage = 'Failed to load weather data.';
            } finally {
                this.refreshing = false;
            }
        },

        celsiusToFahrenheit(c) { return Math.round(c * 9 / 5 + 32); },

        updateDayNight() {
            const h = new Date().getHours();
            this.isDaytime = h >= 6 && h < 18;
        },

        updateDayNightBasedOnTime(sunrise, sunset) {
            const now = Math.floor(Date.now() / 1000);
            this.isDaytime = now > sunrise && now < sunset;
        },

        getWeatherIcon(iconCode) {
            const map = {
                '01d': 'fas fa-sun','01n': 'fas fa-moon',
                '02d': 'fas fa-cloud-sun','02n': 'fas fa-cloud-moon',
                '03d': 'fas fa-cloud','03n': 'fas fa-cloud',
                '04d': 'fas fa-cloud','04n': 'fas fa-cloud',
                '09d': 'fas fa-cloud-showers-heavy','09n': 'fas fa-cloud-showers-heavy',
                '10d': 'fas fa-cloud-sun-rain','10n': 'fas fa-cloud-moon-rain',
                '11d': 'fas fa-bolt','11n': 'fas fa-bolt',
                '13d': 'fas fa-snowflake','13n': 'fas fa-snowflake',
                '50d': 'fas fa-smog','50n': 'fas fa-smog'
            };
            return map[iconCode] || 'fas fa-cloud';
        },

        getWeatherIconColor(iconCode) {
            if (iconCode.includes('01') || iconCode.includes('02')) return 'text-yellow-300';
            if (iconCode.includes('09') || iconCode.includes('10')) return 'text-blue-300';
            if (iconCode.includes('11')) return 'text-yellow-400';
            if (iconCode.includes('13')) return 'text-blue-100';
            return 'text-gray-300';
        },

        initSwiper() {
            new Swiper('.forecast-swiper', {
                slidesPerView: 2,
                spaceBetween: 15,
                pagination: { el: '.swiper-pagination', clickable: true },
                breakpoints: { 640:{slidesPerView:3},768:{slidesPerView:4},1024:{slidesPerView:5},1280:{slidesPerView:7} }
            });
        },

        setupHourlyForecastToggle() {
            document.getElementById('hourly-forecast-toggle').addEventListener('click', function(){
                const c = document.getElementById('hourly-forecast-content');
                const ch = document.getElementById('hourly-chevron');
                if (!c.style.maxHeight || c.style.maxHeight === '0px') { c.style.maxHeight='200px'; ch.style.transform='rotate(180deg)'; }
                else { c.style.maxHeight='0px'; ch.style.transform='rotate(0deg)'; }
            });
        },

        async selectLocation(location) {
            // window.location.href = `/weather?lat=${location.lat}&lon=${location.lon}`;
            this.selectedLocation = location;
            this.map.setView([location.lat, location.lon], 10);
            await this.loadWeatherData();
                       
        },



        
        async refreshWeather() {
            await this.loadWeatherData();
            await this.loadAllLocationsWeather();
            
        },

        getFarmingTip() {
            const tips = [
                'Consider planting drought-resistant crops during dry spells.',
                'Apply mulch to retain soil moisture during hot weather.',
                'Check irrigation systems for leaks and efficiency.',
                'Monitor crops for signs of heat stress during high temperatures.',
                'Plan planting schedules around expected rainfall patterns.',
                'Use row covers to protect young plants from unexpected cold snaps.'
            ];
            return tips[Math.floor(Math.random()*tips.length)];
        }
    };
}


document.addEventListener('DOMContentLoaded', () => {
    console.log('Weather app initialized.');
});
</script>  -->
</body>
</html>