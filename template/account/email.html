{% extends "account/base.html" %}
{% load i18n static allauth %}

{% block head_title %}
    {% trans "Manage Email" %}
{% endblock head_title %}

{% block extra_head %}
<style>
    
    /* Reuse your login styles here */
    .login-container { max-width: 400px; margin: 10px auto; }
    .login-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .login-header { background: linear-gradient(120deg, rgba(20, 83, 45, 0.9) 0%, rgba(101, 163, 13, 0.8) 100%); color: white; padding: 30px; text-align: center; }
    .login-header h2 { font-family: 'Playfair Display', serif; font-weight: 600; margin-bottom: 10px; }
    .login-header p { opacity: 0.9; margin-bottom: 0; }
    .login-body { padding: 30px; }
    .btn-login { background: linear-gradient(120deg, rgba(20, 83, 45, 0.9) 0%, rgba(101, 163, 13, 0.8) 100%); border: none; padding: 12px; font-weight: 600; border-radius: 8px; transition: all 0.3s; }
    .btn-login:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(79,70,229,0.25); }
    .login-footer { padding-top: 15px; font-size: 14px; color: #6c757d; }
    .login-footer a { text-decoration: none; font-weight: 500; }
    .email-item { padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    .badge { font-size: 12px; padding: 2px 6px; border-radius: 4px; }
</style>
{% endblock extra_head %}

{% block content %}
<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <h2>{% trans "Manage Email" %}</h2>
            <p>{% trans "Manage your account emails below" %}</p>
        </div>

        <div class="login-body">

            {% if emailaddresses %}
                <p>{% trans "The following email addresses are associated with your account:" %}</p>

                {% url 'account_email' as email_url %}
                {% element form form=form action=email_url method="post" tags="email,list" %}
                    {% slot body %}
                        {% csrf_token %}
                        {% for radio in emailaddress_radios %}
                            {% with emailaddress=radio.emailaddress %}
                                <div class="email-item">
                                    <div>
                                        <input type="radio" name="email" value="{{ emailaddress.email }}" id="{{ radio.id }}" {% if radio.checked %}checked{% endif %} class="form-check-input me-2">
                                        <label for="{{ radio.id }}" class="form-check-label">{{ emailaddress.email }}</label>
                                        {% if emailaddress.verified %}
                                            <span class="badge bg-success ms-2">{% trans "Verified" %}</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark ms-2">{% trans "Unverified" %}</span>
                                        {% endif %}
                                        {% if emailaddress.primary %}
                                            <span class="badge bg-primary ms-2">{% trans "Primary" %}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endwith %}
                        {% endfor %}
                    {% endslot %}

                    {% slot actions %}
                        <div class="d-flex flex-wrap gap-2 mt-3">
                            <button type="submit" name="action_primary" class="btn btn-login btn-sm">{% trans "Make Primary" %}</button>
                            <button type="submit" name="action_send" class="btn btn-outline-secondary btn-sm">{% trans "Re-send Verification" %}</button>
                            <button type="submit" name="action_remove" class="btn btn-danger btn-sm">{% trans "Remove" %}</button>
                        </div>
                    {% endslot %}
                {% endelement %}
            {% else %}
                {% include "account/snippets/warn_no_email.html" %}
            {% endif %}

            {% if can_add_email %}
                <hr class="my-4">
                <h5 class="mb-3">{% trans "Add Email Address" %}</h5>

                {% url 'account_email' as action_url %}
                {% element form form=form method="post" action=action_url tags="email,add" %}
                    {% slot body %}
                        {% csrf_token %}
                        {% element fields form=form %}
                        {% endelement %}
                    {% endslot %}

                    {% slot actions %}
                        <button type="submit" name="action_add" class="btn btn-login">{% trans "Add Email" %}</button>
                    {% endslot %}
                {% endelement %}
            {% endif %}

            <div class="login-footer text-center mt-4">
                <a href="{% url 'account_change_password' %}">{% trans "Change Password" %}</a>
            </div>

        </div>
    </div>
</div>
{% endblock content %}

{% block extra_body %}
<script src="{% static 'account/js/account.js' %}"></script>
<script src="{% static 'account/js/onload.js' %}"></script>
<script data-allauth-onload="allauth.account.forms.manageEmailForm" type="application/json">
{
    "i18n": {"confirmDelete": "{% trans 'Do you really want to remove the selected email address?' %}"}
}
</script>
{% endblock extra_body %}
