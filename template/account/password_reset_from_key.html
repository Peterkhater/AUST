{% extends "account/base.html" %}
{% load i18n %}
{% load allauth %}
{% load widget_tweaks %}

{% block head_title %}
    {% trans "Change Password" %}
{% endblock head_title %}

{% block extra_head %}
<style>
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        min-height: 100vh;

        padding: 20px;
        color: #2c2724;
    }
    .login-container { max-width: 400px; margin: 10px auto; }
    .login-card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
    .login-card:hover { transform: translateY(-5px); }
    .login-header { background: linear-gradient(120deg, rgba(20, 83, 45, 0.9) 0%, rgba(101, 163, 13, 0.8) 100%); color: white; padding: 30px; text-align: center; }
    .login-header h2 { font-family: 'Playfair Display', serif; font-weight: 600; margin-bottom: 10px; }
    .login-header p { opacity: 0.9; margin-bottom: 0; }
    .login-body { padding: 30px; }
    .form-label { font-weight: 500; margin-bottom: 8px; color: #2c2724; }
    .form-control { padding: 12px 16px; border-radius: 8px; border: 1px solid #d1d5db; transition: all 0.3s; width: 100%; }
    .form-control:focus { border-color: white; box-shadow: 0 0 0 3px rgba(79,70,229,0.15); }
    .input-group-text { background: white; border-radius: 8px 0 0 8px; border: 1px solid #d1d5db; border-right: none; }
    .btn-login { background: linear-gradient(120deg, rgba(20, 83, 45, 0.9) 0%, rgba(101, 163, 13, 0.8) 100%); border: none; padding: 12px; font-weight: 600; border-radius: 8px; transition: all 0.3s; width: 100%; }
    .btn-login:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(79,70,229,0.25); }
    .login-footer { text-align: center; padding: 20px 0 0; font-size: 14px; color: #6c757d; }
    .login-footer a { color: white; text-decoration: none; font-weight: 500; }
    .login-footer a:hover { text-decoration: underline; }
    .text-danger { font-size: 14px; margin-top: 5px; }
    .input-group { display: flex; align-items: center; }
    .input-group .password-toggle { cursor: pointer; background: white; border: 1px solid #d1d5db; border-left: none; border-radius: 0 8px 8px 0; padding: 0 10px; }
</style>
{% endblock extra_head %}

{% block content %}
<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <h2>{% if token_fail %}{% trans "Bad Token" %}{% else %}{% trans "Change Password" %}{% endif %}</h2>
            <p>{% trans "Set a new password for your account" %}</p>
        </div>
        <div class="login-body">
            {% if token_fail %}
                {% url 'account_reset_password' as passwd_reset_url %}
                <div class="alert alert-danger">
                    {% blocktrans %}The password reset link was invalid or already used. Please request a <a href="{{ passwd_reset_url }}">new password reset</a>.{% endblocktrans %}
                </div>
            {% else %}
                <form method="post" action="{{ action_url }}">
                    {% csrf_token %}
                    {{ redirect_field }}
                    
                    {% for field in form %}
                        <div class="mb-4">
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                            <div class="input-group">
                                {{ field|add_class:"form-control" }}
                                {% if field.name == "password1" or field.name == "password2" %}
                                    <span class="input-group-text password-toggle" onclick="togglePassword(this)">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                {% endif %}
                            </div>
                            {% if field.errors %}
                                <div class="text-danger">{{ field.errors }}</div>
                            {% endif %}
                        </div>
                    {% endfor %}

                    <div class="d-grid mb-4">
                        <button type="submit" class="btn-login">
                            {% trans "Change Password" %}
                        </button>
                    </div>
                </form>
            {% endif %}
            <div class="login-footer">
                <a href="{% url 'account_login' %}">{% trans "Back to Login" %}</a>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(el) {
    const input = el.closest('.input-group').querySelector('input');
    const icon = el.querySelector('i');
    if(input.type === 'password') {
        input.type = 'text';
        icon.classList.replace('fa-eye','fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.replace('fa-eye-slash','fa-eye');
    }
}
</script>
{% endblock content %}
